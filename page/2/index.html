<!DOCTYPE html>





<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 3.9.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=7.4.1">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32.ico?v=7.4.1">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16.ico?v=7.4.1">
  <link rel="mask-icon" href="/images/logo.svg?v=7.4.1" color="#222">

<link rel="stylesheet" href="/css/main.css?v=7.4.1">


<link rel="stylesheet" href="/lib/font-awesome/css/font-awesome.min.css?v=4.7.0">


<script id="hexo-configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Gemini',
    version: '7.4.1',
    exturl: false,
    sidebar: {"position":"left","display":"post","offset":12,"onmobile":true},
    copycode: {"enable":true,"show_result":true,"style":null},
    back2top: {"enable":true,"sidebar":true,"scrollpercent":true},
    bookmark: {"enable":false,"color":"#222","save":"auto"},
    fancybox: false,
    mediumzoom: false,
    lazyload: false,
    pangu: false,
    algolia: {
      appID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    },
    localsearch: {"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":true,"preload":true},
    path: 'search.xml',
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    translation: {
      copy_button: '复制',
      copy_success: '复制成功',
      copy_failure: '复制失败'
    },
    sidebarPadding: 40
  };
</script>

  <meta name="description" content="Cyberspace Security">
<meta property="og:type" content="website">
<meta property="og:title" content="xxC1&#39;s blog">
<meta property="og:url" content="https://github.com/xx-C1/xx-C1.github.io/page/2/index.html">
<meta property="og:site_name" content="xxC1&#39;s blog">
<meta property="og:description" content="Cyberspace Security">
<meta property="og:locale" content="zh-CN">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="xxC1&#39;s blog">
<meta name="twitter:description" content="Cyberspace Security">
  <link rel="canonical" href="https://github.com/xx-C1/xx-C1.github.io/page/2/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome: true,
    isPost: false,
    isPage: false,
    isArchive: false
  };
</script>

  <title>xxC1's blog</title>
  








  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .logo,
  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <a href="https://github.com/xx-C1" class="github-corner" aria-label="View source on GitHub"><svg width="80" height="80" viewBox="0 0 250 250" style="fill:#64CEAA; color:#fff; position: absolute; top: 0; border: 0; right: 0;" aria-hidden="true"><path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path><path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2" fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"></path><path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z" fill="currentColor" class="octo-body"></path></svg></a><style>.github-corner:hover .octo-arm{animation:octocat-wave 560ms ease-in-out}@keyframes octocat-wave{0%,100%{transform:rotate(0)}20%,60%{transform:rotate(-25deg)}40%,80%{transform:rotate(10deg)}}@media (max-width:500px){.github-corner:hover .octo-arm{animation:none}.github-corner .octo-arm{animation:octocat-wave 560ms ease-in-out}}</style>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-meta">

    <div>
      <a href="/" class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">xxC1's blog</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
        <p class="site-subtitle">想学的太多，懂得的太少。</p>
      
  </div>

  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>
</div>


<nav class="site-nav">
  
  <ul id="menu" class="menu">
      
      
      
        
        <li class="menu-item menu-item-home">
      
    

    <a href="/" rel="section"><i class="fa fa-fw fa-home"></i>首页</a>

  </li>
      
      
      
        
        <li class="menu-item menu-item-about">
      
    

    <a href="/about/" rel="section"><i class="fa fa-fw fa-user"></i>关于</a>

  </li>
      
      
      
        
        <li class="menu-item menu-item-tags">
      
    

    <a href="/tags/" rel="section"><i class="fa fa-fw fa-tags"></i>标签</a>

  </li>
      
      
      
        
        <li class="menu-item menu-item-categories">
      
    

    <a href="/categories/" rel="section"><i class="fa fa-fw fa-th"></i>分类</a>

  </li>
      
      
      
        
        <li class="menu-item menu-item-archives">
      
    

    <a href="/archives/" rel="section"><i class="fa fa-fw fa-archive"></i>归档</a>

  </li>
      <li class="menu-item menu-item-search">
        <a href="javascript:;" class="popup-trigger">
        
          <i class="fa fa-search fa-fw"></i>搜索</a>
      </li>
    
  </ul>

</nav>
  <div class="site-search">
    <div class="popup search-popup">
    <div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocorrect="off" autocapitalize="none"
           placeholder="搜索..." spellcheck="false"
           type="text" id="search-input">
  </div>
  <span class="popup-btn-close">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div id="search-result"></div>

</div>
<div class="search-pop-overlay"></div>

  </div>
</div>
    </header>

    


    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
            

          <div id="content" class="content">
            

  <div class="posts-expand">
        
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block home" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://github.com/xx-C1/xx-C1.github.io/2019/03/11/Docker学习笔记/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="xx_C1">
      <meta itemprop="description" content="Cyberspace Security">
      <meta itemprop="image" content="/images/dxx.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="xxC1's blog">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
            
            <a href="/2019/03/11/Docker学习笔记/" class="post-title-link" itemprop="url">Docker学习笔记</a>
          
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              
                
              

              <time title="创建时间：2019-03-11 21:32:54" itemprop="dateCreated datePublished" datetime="2019-03-11T21:32:54+08:00">2019-03-11</time>
            </span>
          
            

            
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2019-10-08 19:13:41" itemprop="dateModified" datetime="2019-10-08T19:13:41+08:00">2019-10-08</time>
              </span>
            
          
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/Docker/" itemprop="url" rel="index"><span itemprop="name">Docker</span></a></span>

                
                
              
            </span>
          

          
          <span id="busuanzi_container_page_pv">
            <span class="post-meta-divider">|</span>
            <span class="post-meta-item-icon">
            <i class="fa fa-eye"></i>
            </span>
            阅读量: <span id="busuanzi_value_page_pv"></span>次
          </span>
          <br>
            <span class="post-meta-item" title="本文字数">
              <span class="post-meta-item-icon">
                <i class="fa fa-file-word-o"></i>
              </span>
              
                <span class="post-meta-item-text">本文字数：</span>
              
              <span>9.9k</span>
            </span>
          
            <span class="post-meta-item" title="阅读时长">
              <span class="post-meta-item-icon">
                <i class="fa fa-clock-o"></i>
              </span>
              
                <span class="post-meta-item-text">阅读时长 &asymp;</span>
              
              <span>17 分钟</span>
            </span>
          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="Docker学习笔记整理"><a href="#Docker学习笔记整理" class="headerlink" title="Docker学习笔记整理"></a>Docker学习笔记整理</h1><p><strong>记录Docker学习。重点学习Docker基础和Compose，实践了几个小型项目，下一步运用熟练。</strong> <a name="96ad50d0"></a></p>
<h2 id="一、基本概念"><a href="#一、基本概念" class="headerlink" title="一、基本概念"></a>一、基本概念</h2><hr>
<ul>
<li><p><strong>镜像（Image）：</strong>root文件系统（分层存储，体积小）</p>
</li>
<li><p><strong>容器（Container）：</strong>实质是基于镜像的进程，相当于镜像的实例（在镜像基础上加一层容器运行时的存储层）</p>
</li>
<li><p><strong>仓库（Registry</strong>）：集中存储、分发镜像的服务（包含多个仓库，每个仓库可包含多个标签）</p>
</li>
<li><p><strong>国内加速</strong></p>
</li>
</ul>
<h2 id="二、安装Docker"><a href="#二、安装Docker" class="headerlink" title="二、安装Docker"></a>二、安装Docker</h2><hr>
<h2 id="三、使用镜像"><a href="#三、使用镜像" class="headerlink" title="三、使用镜像"></a>三、使用镜像</h2><hr>
<h3 id="（一）获取镜像："><a href="#（一）获取镜像：" class="headerlink" title="（一）获取镜像："></a>（一）获取镜像：</h3><ul>
<li><p><code>docker pull [选项] [仓库地址] 仓库名：标签</code></p>
</li>
<li><p><code>如：docker pull ubuntu:14.04</code></p>
</li>
</ul>
<h3 id="（二）列出镜像："><a href="#（二）列出镜像：" class="headerlink" title="（二）列出镜像："></a>（二）列出镜像：</h3><ul>
<li><p><code>docker image ls</code>（因镜像多层存储，可以继承、复用，故镜像体积和并非是实际硬盘消耗）</p>
</li>
<li><p>查看镜像、容器、数据卷所占用空间：<code>docker sysytem df</code></p>
</li>
<li><p>悬虚镜像：新旧镜像同名，使得旧镜像被取消从而仓库名、标签都为<none></none></p>
</li>
<li><p>显示悬虚镜像：<code>docker image ls -f dangling=true</code></p>
</li>
<li><p>删除悬虚镜像：<code>docker iamge prune</code>（悬虚镜像已经失去存在价值，可随意删除）</p>
</li>
<li><p>中间层镜像：其他镜像所依赖的镜像（不可删除）</p>
</li>
<li><p>显示中间层镜像：<code>docker iamge ls -a</code></p>
</li>
<li><p>列出部分镜像：<code>docker image ls [镜像名]</code></p>
</li>
<li><p>使用filter过滤：<code>docker image ls -f since/before=xxx</code></p>
</li>
<li><p>列出镜像的ID：<code>docker image ls -q</code></p>
</li>
<li><p>列出镜像摘要：<code>docker iamge ls --digests</code></p>
</li>
<li><p>指定格式列出：<code>docker image ls --format &quot;{ {.ID}}:{ {.Repository}}&quot;</code></p>
</li>
</ul>
<h3 id="（三）删除镜像"><a href="#（三）删除镜像" class="headerlink" title="（三）删除镜像"></a>（三）删除镜像</h3><ul>
<li><code>docker iamge rm [选项][镜像]</code> * 注：镜像可以是：长/短ID、镜像名、镜像摘要</li>
</ul>
<h3 id="（四）镜像构成"><a href="#（四）镜像构成" class="headerlink" title="（四）镜像构成"></a>（四）镜像构成</h3><ul>
<li><p>启动镜像：<code>docker run --name webserver -d -p 80:80 nginx</code>（用nginx镜像启动一个命名为webserver的容器，并映射到80端口）</p>
</li>
<li><p>进入镜像：<code>docker exec -it [容器名字] [shell]</code></p>
</li>
<li><p>查看改动：<code>docker diff [容器名字]</code></p>
</li>
<li><p>把容器保存为镜像：<code>docker commit [选项] &lt;容器ID&gt; [容器名字]</code>（给原来镜像新添加一层，形成新镜像，自己定制的黑箱镜像。慎用！）</p>
</li>
</ul>
<h3 id="（五）镜像定制"><a href="#（五）镜像定制" class="headerlink" title="（五）镜像定制"></a>（五）镜像定制</h3><ul>
<li><p>定制每一层所添加的配置、文件来定制镜像（Dockerfile脚本一键化来快速构建）</p>
</li>
<li><p>什么是Dockerfile？其是包含了一条条命令的文本文件，每一条命令为一层，每一条命令描述该层如何构建。</p>
</li>
<li><p>Dockerfile指令详解：</p>
</li>
<li><p><strong>1.FROM：</strong>指定基础镜像，必须有且为第一条命令。（scratch为空白镜像，不以任何系统为基础。不需要系统支持，比较适合Go语言）</p>
</li>
<li><p><strong>2.RUN：</strong>执行命令行命令。</p>
</li>
</ul>
<p>shell格式：命令行格式 exec格式：RUN [“可执行文件” , “参数1” , “参数2”]，像是函数调用中的格式  </p>
<ul>
<li><strong>层数问题？</strong></li>
</ul>
<p>每个shell命令一个RUN则每个命令构建一层，耗费资源！（目前最大可建127层） 解决：\换行格式化（清晰、排障），&amp;&amp;串联。 最后清理删除无关文件（比如apt缓存文件，避免镜像臃肿）  </p>
<ul>
<li><p>使用Dockerfile构建镜像：<code>docker build [选项] &lt;上下文路径/URL&gt;</code>(一般路径为”.”，代表当前路径因为Dockerfile在当前路径)</p>
<ul>
<li>build原理：远程调用Docker服务端的Docker引擎来实现。（若最后为”.”，打包本地址内容上传到Docker引擎）</li>
</ul>
</li>
<li><p>用Git repo构建：<code>docker build</code><a href="http://github.com/twang2218/gitlab-ce-zh.git"><code>http://github.com/twang2218/gitlab-ce-zh.git</code></a></p>
</li>
<li><p>用tar压缩包构建：<code>docker build http://server/context.tar.gz</code></p>
</li>
<li><p>从标准输出中读取Dockerfile进行构建：<code>docker build - &lt; Dockerfile（或cat Dockerfile | docker build -）</code></p>
</li>
<li><p>从标准输入中读取上下文压缩包进行构建：<code>docker build - &lt; context.tar.gz</code></p>
</li>
</ul>
<h3 id="（六）Dockerfile命令详解"><a href="#（六）Dockerfile命令详解" class="headerlink" title="（六）Dockerfile命令详解"></a>（六）Dockerfile命令详解</h3><ul>
<li><strong>3.COPY：</strong>复制文件</li>
</ul>
<p>命令行：<code>COPY [--chown=&lt;user&gt;:&lt;group&gt;] &lt;源路径&gt;...&lt;目标路径&gt;</code> 函数调用：<code>COPY [--chown=&lt;user&gt;:&lt;group&gt;] [&quot;&lt;源路径&gt;&quot;,...&quot;&lt;目标路径&gt;&quot;]</code> <strong>注：</strong>原路径可以是多个，甚至可以是通配符，其规则要满足Go的filepath.Math规则 源文件的元数据都会保留！比如：读写、执行权限等  </p>
<ul>
<li><strong>4.ADD：</strong>更高级的文件复制</li>
</ul>
<p>&lt;源路径&gt;可以是URL或者tar压缩文件，下载后默认权限为600（最好不要用）  </p>
<ul>
<li><strong>5.CMD：</strong>容器启动命令.</li>
</ul>
<p>shell格式：<code>CMD &lt;命令&gt;（实际是被包装为sh -c 的参数进行执行）</code> exec格式：<code>CMD [&quot;可执行文件&quot;, &quot;参数1&quot;, &quot;参数2&quot;....]（被解析为JSON数组）</code>  </p>
<ul>
<li><strong>6.ENTRYPOINT：</strong>入口点（目的同CMD，指定容器启动程序及参数）</li>
</ul>
<p>shell格式： exec格式： CMD内容作为参数传到RNTRYPOINT（目的可以加后续参数）  </p>
<ul>
<li><strong>7.ENV：</strong>设置环境变量（后续指令中可以使用环境变量，而升级只需要改变环境变量版本，利于维护Dockerfile）</li>
</ul>
<p><code>ENV &lt;key&gt; &lt;value&gt;</code> <code>ENV &lt;key1&gt;=&lt;value1&gt; &lt;key2&gt;=&lt;value2&gt;...</code>  </p>
<ul>
<li><strong>8.ARG：</strong>构建参数</li>
</ul>
<p><code>ARG &lt;参数名&gt;[=&lt;默认值&gt;]</code> ARG同EVN，但是其环境变量在容器运行时不会存在。  </p>
<ul>
<li><strong>9.VOLUME：</strong>定义匿名卷（尽量爆出容器存储层不发生写操作）</li>
</ul>
<p><code>VOLUME [&quot;&lt;路径1&gt;&quot;, &quot;路径2&quot;...]</code> <code>VOLUME &lt;路径&gt;</code>  </p>
<ul>
<li><strong>10.EXPOSE：</strong>声明端口（帮助使用者理解镜像服务的守护段，方便配置映射；运行时随机端口映射随机映射EXPOSE的端口）</li>
</ul>
<p><code>EXPOSE &lt;端口1&gt; [&lt;端口2&gt;...]</code> <strong>注：</strong>仅仅声明容器打算使用什么端口，并没有实际映射端口  </p>
<ul>
<li><strong>11.WORKDIR：</strong>指定工作目录（指定工作目录，如果没有自动创建）</li>
</ul>
<p><code>WORKDIR &lt;工作目录路径&gt;</code> 保证各层的当前目录就被改为制定的目录  </p>
<ul>
<li><strong>12.USER：</strong>指定当前用户（同WORKDIR，改变环境状态并影响以后的层。改变之后各层的执行RUN、CMD、ENRTRYPOINT这类命令的身份）</li>
</ul>
<p><code>USER &lt;用户名&gt;[:&lt;用户组&gt;]</code>  </p>
<ul>
<li><strong>13.HEALTHCHECK：</strong>健康检查</li>
</ul>
<p><code>HEALTHCHECK [选项] CMD &lt;命令&gt;</code>：设置检查容器健康的命令 HEALTHCHECK NONE：屏蔽基础镜像的健康检查 支持下列选项： –interval=&lt;间隔&gt;（两次检查间隔，默认30s） –timeout=&lt;时长&gt;（超时时间，默认30s） –retries=&lt;次数&gt;（失败次数限制，超过则unhealthy）  </p>
<ul>
<li><strong>14.ONBUILD：</strong>为他人做嫁衣裳</li>
</ul>
<p><code>ONBULID &lt;其他指令&gt;（</code>其他指令当以当前的镜像为基础镜像 构建下一季镜像的时候才会被执行） </p>
<h3 id="（七）其他制作镜像的方式"><a href="#（七）其他制作镜像的方式" class="headerlink" title="（七）其他制作镜像的方式"></a>（七）其他制作镜像的方式</h3><ul>
<li><strong>1.从rootfs压缩包导入</strong></li>
</ul>
<p><code>docker import [选项] &lt;文件&gt;|&lt;URL&gt;| - [&lt;仓库名&gt;[:&lt;标签&gt;]]</code> （压缩包可以是本地文件、远程web文件。从镜像/目录展开并直接作为镜像第一层提交）</p>
<ul>
<li><strong>2.Docker save 和 Docker load</strong></li>
</ul>
<p>将镜像保存为一个文件，然后传输到另外一个位置上，再加载进去。 <code>Docker save [仓库名] -o [filename]</code> 或 <code>docker save [仓库名] | gzip &gt; filename.tar.gz</code> 加载：<code>docker load -i filename.tar.gz</code> </p>
<h3 id="（八）镜像实现原理"><a href="#（八）镜像实现原理" class="headerlink" title="（八）镜像实现原理"></a>（八）镜像实现原理</h3><p>很多层构成，使用Uinon FS将这些不同的层结合到一个镜像中去。</p>
<h2 id="四、操作容器"><a href="#四、操作容器" class="headerlink" title="四、操作容器"></a>四、操作容器</h2><hr>
<h3 id="（一）启动"><a href="#（一）启动" class="headerlink" title="（一）启动"></a>（一）启动</h3><ul>
<li>1.基于镜像新建容器并启动</li>
</ul>
<p>启动终端：<code>docker run -t -i unbuntu:18.04 /bin/bash</code> -t：分配伪终端，绑定到容器的标准输入上 -i：让容器的标准输入保持打开 流程： * 检查本地是否存在指定镜像，没有就在公有仓下载  * 利用景象创建并启动一个容器 * 分配一个文件系统，并在只读的镜像层外面挂载一层可读写层 * 从宿主主机配置的网桥借口中桥街一个虚拟借口到容器中去 * 从地址池配置一个ip地址给容器 * 执行用户指定的应用程序 * 执行完毕后容器被终止</p>
<ul>
<li>2.将终止状态的容器重启</li>
</ul>
<p><code>docker container start</code> <code>docker container restart</code></p>
<h3 id="（二）守护态运行"><a href="#（二）守护态运行" class="headerlink" title="（二）守护态运行"></a>（二）守护态运行</h3><ul>
<li><p>后台运行，不需要直接把执行命令的结构输出在当前宿主机下</p>
</li>
<li><p>后台运行命令：<code>docker run -d</code></p>
</li>
<li><p>获取容器输出的信息：<code>docker container logs</code></p>
</li>
</ul>
<h3 id="（三）终止容器"><a href="#（三）终止容器" class="headerlink" title="（三）终止容器"></a>（三）终止容器</h3><ul>
<li><p>docker container stop</p>
</li>
<li><p>对于一个只启动了终端的容器，exit或ctrl+d推出终端时，所创建的容器立刻停止。</p>
</li>
</ul>
<h3 id="（四）进入容器"><a href="#（四）进入容器" class="headerlink" title="（四）进入容器"></a>（四）进入容器</h3><ul>
<li><p><code>docker attach ID/名</code>（从stdin中exit会导致容器停止）</p>
</li>
<li><p><code>docker exec -it ID/名</code>（从stdin中exit不会导致容器停止）</p>
</li>
</ul>
<h3 id="（五）导出和导入容器"><a href="#（五）导出和导入容器" class="headerlink" title="（五）导出和导入容器"></a>（五）导出和导入容器</h3><ul>
<li><p>1.导出容器：<code>docker export ID &gt; xxx.tar</code></p>
</li>
<li><p>2.导入容器：<code>docker import URL/文件</code>（与load区别：容器快照将丢弃所所有的历史记录和元数据可以重新指定标签元素）</p>
</li>
</ul>
<h3 id="（六）删除容器"><a href="#（六）删除容器" class="headerlink" title="（六）删除容器"></a>（六）删除容器</h3><ul>
<li><p>删除终止的容器：<code>docker container rm xxx</code></p>
</li>
<li><p>删除正在运行容器：<code>docker container rm -f xxx</code></p>
</li>
<li><p>清理所有终止的容器：<code>docker container prune</code></p>
</li>
</ul>
<h2 id="五、访问仓库"><a href="#五、访问仓库" class="headerlink" title="五、访问仓库"></a>五、访问仓库</h2><hr>
<h3 id="（一）Docker-Hub"><a href="#（一）Docker-Hub" class="headerlink" title="（一）Docker Hub"></a>（一）Docker Hub</h3><h3 id="（二）私有仓库"><a href="#（二）私有仓库" class="headerlink" title="（二）私有仓库"></a>（二）私有仓库</h3><ul>
<li>官方工具：docker-registry <a name="2e43f1cc"></a></li>
</ul>
<h3 id="（三）高级私有仓库"><a href="#（三）高级私有仓库" class="headerlink" title="（三）高级私有仓库"></a>（三）高级私有仓库</h3><h3 id="（四）Nexus3-x的私有仓库"><a href="#（四）Nexus3-x的私有仓库" class="headerlink" title="（四）Nexus3.x的私有仓库"></a>（四）Nexus3.x的私有仓库</h3><h2 id="六、数据管理"><a href="#六、数据管理" class="headerlink" title="六、数据管理"></a>六、数据管理</h2><hr>
<h3 id="（一）数据卷（类似于linux下队目录或文件进行mount）"><a href="#（一）数据卷（类似于linux下队目录或文件进行mount）" class="headerlink" title="（一）数据卷（类似于linux下队目录或文件进行mount）"></a>（一）数据卷（类似于linux下队目录或文件进行mount）</h3><ul>
<li><p><strong>1.特点：</strong></p>
<ul>
<li><p>可供一个或多个容器共享使用和重用</p>
</li>
<li><p>对数据卷的修改会立马生效</p>
</li>
<li><p>对数据卷的更新不会影响镜像</p>
</li>
<li><p>数据卷默认一直存在，即使容器被删除</p>
</li>
</ul>
</li>
</ul>
<ul>
<li><p><strong>2.创建数据卷：</strong></p>
<ul>
<li><code>docker volume create my-vol</code></li>
</ul>
</li>
<li><p><strong>3.查看所有的数据卷：</strong></p>
<ul>
<li><code>docker volume ls</code></li>
</ul>
</li>
<li><p><strong>4.查看指定数据卷的信息：</strong></p>
<ul>
<li><code>docker volume inspect xxx</code></li>
</ul>
</li>
<li><p><strong>5.启动一个挂载数据卷的容器：</strong></p>
<ul>
<li><code>--mount source=xxx,target=/xxxx</code></li>
</ul>
</li>
<li><p><strong>6.查看容器的数据卷具体信息：</strong></p>
<ul>
<li><code>docker inspect xxx</code></li>
</ul>
</li>
<li><p><strong>7.删除数据卷：</strong></p>
<ul>
<li><code>docker volume rm xxx</code></li>
</ul>
</li>
<li><p><strong>8.删除容器同时删除数据卷：</strong></p>
<ul>
<li><code>docker rm -v</code></li>
</ul>
</li>
<li><p><strong>9.清理无主的数据卷：</strong></p>
<ul>
<li><code>docker volume prune</code></li>
</ul>
</li>
</ul>
<h3 id="（二）挂载主机目录"><a href="#（二）挂载主机目录" class="headerlink" title="（二）挂载主机目录"></a>（二）挂载主机目录</h3><ul>
<li><p><strong>1.挂载主机目录为数据卷</strong></p>
</li>
<li><p><code>--mount type=bind,source=/src/webapp,target=/opt/webapp</code>（挂载主机的/sec/webapp到/opt/webapp目录）</p>
<ul>
<li><p>默认权限为：读写</p>
</li>
<li><p>添加命令只读：<code>--mount type=bind,source=/src/webapp,target=/opt/webapp,readonly</code></p>
</li>
</ul>
</li>
<li><p><strong>2.挂载主机文件为数据卷</strong></p>
</li>
<li><p><code>--mount type=bild,source=$HOME/.bash_historytarget=/root/.bash_history</code>（可用来记录容器输入果的命令）</p>
</li>
</ul>
<h2 id="七、使用网络"><a href="#七、使用网络" class="headerlink" title="七、使用网络"></a>七、使用网络</h2><hr>
<h3 id="（一）外部访问容器"><a href="#（一）外部访问容器" class="headerlink" title="（一）外部访问容器"></a>（一）外部访问容器</h3><ul>
<li><p>-P：随机映射49000-49900的端口</p>
</li>
<li><p>-p：指定要映射的端口（可以多次使用来绑定多个端口）</p>
</li>
<li><p>映射所有借口地址：<code>-p 5000:5000</code></p>
</li>
<li><p>映射到指定地址的指定端口：<code>-p 127.0.0.1:5000:5000</code></p>
</li>
<li><p>映射到指定地址的任意端口：<code>-p 127.0.0.1:：5000</code></p>
</li>
<li><p>可以用udp来指定udp端口：<code>-p 127.0.0.1:5000:5000/udp</code></p>
</li>
<li><p>查看映射端口配置：<code>docker port</code></p>
</li>
</ul>
<h3 id="（二）容器互联"><a href="#（二）容器互联" class="headerlink" title="（二）容器互联"></a>（二）容器互联</h3><ul>
<li><p>老习惯：<code>--link</code></p>
</li>
<li><p>新建网络：<code>docker network create -d bridge my-net</code></p>
<ul>
<li>注：-d参数指定Docker网络类型，有bridge、overlay（适用于Swarm mode）</li>
</ul>
</li>
<li><p>链接容器： * <code>docker run -it --rm --name busybox1 --network my-net busybos sh</code> * <code>docker run -it --rm --name busybox2 --network my-net busybos sh</code></p>
</li>
<li><p>可以使用Ping命令来证明</p>
</li>
<li><p>多个容器互联：<code>Docker Compse</code></p>
</li>
</ul>
<h3 id="（三）配置DNS"><a href="#（三）配置DNS" class="headerlink" title="（三）配置DNS"></a>（三）配置DNS</h3><ul>
<li><p>Docker利用虚拟文件来挂载容器的3个相关配置文件</p>
</li>
<li><p>容器中mount命令可以看到挂载的信息（宿主主机DNS信息发生更新后，所有Docker容器的DNS配置通过/etc/resolv.conf文件立刻得到更新）</p>
</li>
<li><p>自动配置：在<code>/etc/docker/daemon.json</code>文件中增加以下内容</p>
</li>
</ul>
<p><code>{</code> <code>&quot;dns&quot;:[</code> <code>&quot;114.114.114.114&quot;,</code> <code>&quot;8.8.8.8&quot;</code> <code>]</code> <code>}</code></p>
<ul>
<li><p>可以使用<code>docker run -it --rm ubuntu:18.04 cat etc/resolv.conf</code>来证明其已经生效</p>
</li>
<li><p>手动配置：</p>
</li>
<li><p>设定主机名：-<code>h HOSTNAME或--hostname=HOSTNAME</code>（写到容器内的/etc/hostname和/etc/hosts）</p>
</li>
<li><p>添加DNS服务器到容器的<code>/etc/resolv.conf中：--dns=IP_ADDRESS</code>（让容器用这个服务器来解析所有不在/etc/hosts中的主机名）</p>
</li>
<li><p>设定容器的搜索域：<code>--dns-search=DOMAIN</code></p>
</li>
</ul>
<h2 id="八、高级网络配置"><a href="#八、高级网络配置" class="headerlink" title="八、高级网络配置"></a>八、高级网络配置</h2><hr>
<h2 id="九、Docker三剑客之Compose项目"><a href="#九、Docker三剑客之Compose项目" class="headerlink" title="九、Docker三剑客之Compose项目"></a>九、Docker三剑客之Compose项目</h2><hr>
<h3 id="（一）简介"><a href="#（一）简介" class="headerlink" title="（一）简介"></a>（一）简介</h3><ul>
<li><p>Compose使用doekcer-compose.yml模板文件来管理项目（Python编写，只要支持Docker API就可用）</p>
</li>
<li><p>服务：一个应用容器（可包含若干运行相同镜像的容器实例）</p>
</li>
<li><p>项目：应用容器组成的完整业务单元</p>
</li>
</ul>
<h3 id="（二）安装卸载"><a href="#（二）安装卸载" class="headerlink" title="（二）安装卸载"></a>（二）安装卸载</h3><ul>
<li><p><code>Python pip：sudo pip install -U docker-compose</code>（卸载：<code>sudo pip uninstall docker-compose</code>）</p>
</li>
<li><p>curl下载后，改成执行权限：<code>chmod +x /usr/local/bin/docker-compse</code>（卸载：<code>sudo rm /usr/local/bin/docker-compose</code>）</p>
</li>
<li><p>容器中执行</p>
</li>
</ul>
<h3 id="（三）使用"><a href="#（三）使用" class="headerlink" title="（三）使用"></a>（三）使用</h3><ul>
<li><p>1.写好每个容器的Dockerfile</p>
</li>
<li><p>2.写好yml链接文件</p>
</li>
<li><p>3.docker-compose up</p>
</li>
</ul>
<h3 id="（四）命令说明"><a href="#（四）命令说明" class="headerlink" title="（四）命令说明"></a>（四）命令说明</h3><ul>
<li><p><strong>1.命令对象</strong>：默认项目（项目中所有的服务都会受影响），也可为项目中的服务或容器</p>
</li>
<li><p><strong>2.帮助</strong>：<code>--help</code></p>
</li>
<li><p><strong>3.命令格式</strong>：<code>docker-compse [-f=...] [options] [COMMAND] [ARGS...]</code></p>
<ul>
<li><p><code>-f:</code>指定Compse模版文件，默认为docker-compose.yml</p>
</li>
<li><p><code>-p:</code>指定项目名称，默认将使用所在目录名</p>
</li>
<li><p><code>--x-networking:Docker：</code>的可拔插网络后端特性</p>
</li>
<li><p><code>--x-network-driver DRIVER:</code>指定网络后端的驱动，默认为bridge</p>
</li>
<li><p><code>--verbose：</code>输出更多调试信息</p>
</li>
<li><p><code>-v：</code>打印版本信息</p>
</li>
</ul>
</li>
<li><p><strong>4.build</strong></p>
<ul>
<li><p><code>docker-compose build [option] [SERVICE...]</code></p>
</li>
<li><p>构建（重新构建）项目中的服务容器（可随时重新构建项目）</p>
</li>
<li><p><code>--fore-rm：</code>删除构建过程中的临时容器</p>
</li>
<li><p><code>--no-cache：</code>构建过程不使用cache（chche加长构建过程）</p>
</li>
<li><p><code>--pull：</code>始终尝试通过pull来获取更新版本的镜像</p>
</li>
</ul>
</li>
<li><p><strong>5.config</strong></p>
<ul>
<li>验证Compose文件格式是否正常（正确显示匹配，错误显示原因）</li>
</ul>
</li>
<li><p><strong>6.down</strong></p>
<ul>
<li>停止up命令所启动的容器，并移除网络</li>
</ul>
</li>
<li><p><strong>7.exec</strong></p>
<ul>
<li>进入指定的容器</li>
</ul>
</li>
<li><p><strong>8.help</strong></p>
</li>
<li><p><strong>9.images</strong></p>
<ul>
<li>列出Compose文件中包含的镜像</li>
</ul>
</li>
<li><p><strong>10.kill</strong></p>
<ul>
<li><p><code>Docker-compose kill [option] [SERVICE...]</code></p>
</li>
<li><p>发送DIGKILL信号来强制停止服务容器</p>
</li>
<li><p>-s：指定发送的信号</p>
</li>
</ul>
</li>
<li><p><strong>11.logs</strong></p>
<ul>
<li><p><code>docker-compose logs [][]</code></p>
</li>
<li><p>查看服务器的输出（默认使用不同颜色区分，–no-color来关闭颜色）</p>
</li>
</ul>
</li>
<li><p><strong>12.pause</strong></p>
<ul>
<li><p><code>docker-compose pause []</code></p>
</li>
<li><p>暂停一个服务容器</p>
</li>
</ul>
</li>
<li><p><strong>13.port</strong></p>
<ul>
<li><p><code>docker-compose port [ ]</code></p>
</li>
<li><p>打印某个容器端口所映射的公共端口</p>
</li>
<li><p><code>--protocol=proto:</code>指定端口协议，默认tcp可指定udp</p>
</li>
<li><p><code>--index=index：</code>指定命令容器的序号</p>
</li>
</ul>
</li>
<li><p><strong>14.ps</strong></p>
<ul>
<li><p>列出项目所有容器</p>
</li>
<li><p>-q：只打印ID</p>
</li>
</ul>
</li>
<li><p><strong>15.pull</strong></p>
<ul>
<li><p><code>docker-compose pull [][]</code></p>
</li>
<li><p>拉取服务依赖的镜像</p>
</li>
<li><p><code>--ignore-pull-failures：</code>忽略拉取镜像过程中的错误</p>
</li>
</ul>
</li>
<li><p><strong>16.push</strong></p>
<ul>
<li>推送服务依赖的镜像到Docker镜像仓库</li>
</ul>
</li>
<li><p><strong>17.restart</strong></p>
<ul>
<li><p><code>docker-compose restart [][]</code></p>
</li>
<li><p>重启</p>
</li>
<li><p>-t：重启前停止容器的超时</p>
</li>
</ul>
</li>
<li><p><strong>18.rm</strong></p>
<ul>
<li><p><code>docker-compose rm [][]</code></p>
</li>
<li><p>删除所有（停止状态的）服务容器</p>
</li>
<li><p>-f：强制直接删除</p>
</li>
<li><p>-v：删除容器所挂在的数据卷</p>
</li>
</ul>
</li>
<li><p><strong>19.run</strong></p>
<ul>
<li><p><code>docker-compose run [option] [-p PORT...] [-e KEY=VAL...] SERVOCE [COMMAND][ARGS...]</code></p>
</li>
<li><p>在指定服务上执行一个命令，默认启动关联容器（–no–deps关闭）</p>
</li>
<li><p>-d：后台运行容器</p>
</li>
<li><p><code>--name NAME：</code>为容器指定一个名字</p>
</li>
<li><p><code>--entrypoint CMD：</code>覆盖默认的容器启动指令</p>
</li>
<li><p><code>-e KEY=VAL：</code> 设置环境变量值，可多次使用选项来设置多个环境变量</p>
</li>
<li><p><code>-u：</code>指定运行容器的用户名或uid</p>
</li>
<li><p><code>--no-deps：</code>关闭自动启动关联</p>
</li>
<li><p><code>--rm：</code>运行命令后自动删除容器，d模式下将忽略</p>
</li>
<li><p><code>-p：</code>映射容器端口到本地主机</p>
</li>
<li><p><code>--service-ports：</code>配置服务端口并映射到本地主机</p>
</li>
<li><p><code>-T：</code>不分配伪tty（tty命令无法执行）</p>
</li>
</ul>
</li>
<li><p><strong>20.scale</strong></p>
<ul>
<li><p><code>docker-compse scale [optins][service=$num]</code></p>
</li>
<li><p>设置指定服务运行的容器个数</p>
</li>
<li><p>-t：停止容器时超时</p>
</li>
</ul>
</li>
<li><p><strong>21.start</strong></p>
<ul>
<li><p><code>docker-compose start []</code></p>
</li>
<li><p>启动已经存在的服务容器</p>
</li>
</ul>
</li>
<li><p><strong>22.stop</strong></p>
<ul>
<li><p><code>docker-compose stop [][]</code></p>
</li>
<li><p>停止运行的容器</p>
</li>
<li><p>-t：停止容器的时候超时</p>
</li>
</ul>
</li>
<li><p><strong>23.top</strong></p>
<ul>
<li>查看各个服务器内运行的进程</li>
</ul>
</li>
<li><p><strong>24.unpause</strong></p>
<ul>
<li><p><code>docker-compose unpause []</code></p>
</li>
<li><p>恢复暂停的服务</p>
</li>
</ul>
</li>
<li><p><strong>25.up</strong></p>
<ul>
<li><p><code>docker up [][]</code></p>
</li>
<li><p>自动构建镜像、（重新）创建服务、启动服务、关联服务相关容器</p>
</li>
<li><p>Ctrl+c停止所有容器</p>
</li>
<li><p>若服务容器已经存在，则尝试停止所有容器并重新创建</p>
</li>
<li><p><code>-d：</code>在后台启动并运行所有容器</p>
</li>
<li><p><code>--no-color：</code>不使用颜色来区分不同的服务的通知台输出</p>
</li>
<li><p><code>--no-deps：</code>不启动服务器所链接的容器</p>
</li>
<li><p><code>--force-recreate：</code>强制重新创建容器</p>
</li>
<li><p><code>--no-recreate：</code>如果容器已经存在则不重新创建</p>
</li>
<li><p><code>--no-build：</code>不自动构建缺失的服务镜像</p>
</li>
<li><p><code>-t：</code>停止容器的时候超时</p>
</li>
</ul>
</li>
<li><p><strong>26.version</strong></p>
<ul>
<li>打印版本信息</li>
</ul>
</li>
</ul>
<h3 id="（五）yml模版文件"><a href="#（五）yml模版文件" class="headerlink" title="（五）yml模版文件"></a>（五）yml模版文件</h3><ul>
<li><p>默认YAML格式的docker-compose.yml</p>
</li>
<li><p>注意：每个服务必须通过image指令指定镜像或build指令（需要Dockerfile）等来自动构建生成镜像</p>
</li>
<li><p>如果使用build指令，在Dockerfile中设置的选项（如：CMD、EXPOSE、VOLUME、ENV等）将会自动被获取无需再Docfile.yml文件中再次设置</p>
</li>
<li><p><strong>1.build</strong></p>
<ul>
<li><p>指定Dockerfile所在文件夹的路径（绝对或相对yml）</p>
</li>
<li><p>也可以：context指令指定Dockerfile所在文件夹的路径 ，使用dockerfile指令指定Docfile文件名，args指令指定构建镜像时的变量、chahce_from指定构建镜像的缓存</p>
</li>
</ul>
</li>
<li><p><strong>2.cap_add/cap_drop</strong></p>
<ul>
<li><p>指定容器的内核能力（capacity）分配</p>
</li>
<li><p>拥有所有能力：</p>
</li>
</ul>
</li>
</ul>
<p><code>cap_add:</code> <code>-ALL</code></p>
<ul>
<li>去掉NET_ADMIN能力：</li>
</ul>
<p><code>cap_drop:</code> <code>-NET_ADMIN</code></p>
<ul>
<li><p><strong>3.command</strong></p>
<ul>
<li>覆盖容器启动后默认执行的命令</li>
</ul>
</li>
<li><p><strong>4.configs</strong></p>
<ul>
<li>仅用于Swarm mode</li>
</ul>
</li>
<li><p><strong>5.cgroup_parent</strong></p>
<ul>
<li>指定父cgroup组，继承该组的资源限制</li>
</ul>
</li>
<li><p><strong>6.container_name</strong></p>
<ul>
<li><p>指定容器名称，默认：项目名称-服务名称-序号</p>
</li>
<li><p><code>container_name: docker-web-container</code></p>
</li>
</ul>
</li>
<li><p><strong>7.deploy</strong></p>
<ul>
<li>仅用于Swarm mode</li>
</ul>
</li>
<li><p><strong>8.devices</strong></p>
<ul>
<li>指定设备映射关系</li>
</ul>
</li>
<li><p><strong>9.depends_on</strong></p>
<ul>
<li>解决容器的依赖和启动先后问题，先启动depends_on。</li>
</ul>
</li>
<li><p><strong>10.dns</strong></p>
<ul>
<li>自定义DNS服务器，可以是值、列表</li>
</ul>
</li>
<li><p><strong>11.dns_search</strong></p>
<ul>
<li>配置DNS搜索域，可以是值、列表</li>
</ul>
</li>
<li><p><strong>12.tmpfs</strong></p>
<ul>
<li>挂载一个tmpfs文件系统到容器</li>
</ul>
</li>
<li><p><strong>13.env_file</strong></p>
<ul>
<li><p>从文件中获取环境变量，可以为单独的文件路径或列表（若-f指定模版文件则变量的路径基于模版文件）</p>
</li>
<li><p>注：环境变量文件中每一行必须符合格式</p>
</li>
</ul>
</li>
<li><p><strong>14.environment</strong></p>
<ul>
<li><p>设置环境变量，支持数组或字典格式</p>
</li>
<li><p>只给定名称的变量会自动获取运行Compose主机上对应变量的值，可以防止泄漏不必要的数据</p>
</li>
</ul>
</li>
<li><p><strong>15.expose</strong></p>
<ul>
<li>暴漏端口，但不映射到宿主机，只被链接的服务访问</li>
</ul>
</li>
<li><p><strong>16.external_links</strong></p>
<ul>
<li>链接yml外部的容器</li>
</ul>
</li>
<li><p><strong>17.extra_hosts</strong></p>
<ul>
<li>指定额外的host名称映射信息</li>
</ul>
</li>
<li><p><strong>18.healthcheck</strong></p>
<ul>
<li>通过命令检查容器是否健康运行</li>
</ul>
</li>
<li><p><strong>19.image</strong></p>
<ul>
<li>指定为镜像名称或ID</li>
</ul>
</li>
<li><p><strong>20.labels</strong></p>
<ul>
<li>为容器添加Docker元数据（metadata）信息    </li>
</ul>
</li>
<li><p><strong>21.links</strong></p>
<ul>
<li>不推荐使用</li>
</ul>
</li>
<li><p><strong>22.logging</strong></p>
<ul>
<li><p>配置日志选项</p>
</li>
<li><p>dirver:支持三种日志驱动类型：<code>&quot;json-file&quot;,&quot;syslog&quot;,&quot;none&quot;</code></p>
</li>
<li><p>options:配置日志驱动的相关参数</p>
</li>
</ul>
</li>
<li><p><strong>23.network_mode</strong></p>
<ul>
<li>设置网络模式</li>
</ul>
</li>
<li><p><strong>24.networks</strong></p>
<ul>
<li>配置容器链接的网络</li>
</ul>
</li>
<li><p><strong>25.pid</strong></p>
<ul>
<li>跟主机系统共享进程命名空间</li>
</ul>
</li>
<li><p><strong>26.ports</strong></p>
<ul>
<li>暴漏端口信息    </li>
</ul>
</li>
<li><p><strong>27.secrets</strong></p>
<ul>
<li>存储敏感数据，如mysql服务密码</li>
</ul>
</li>
<li><p><strong>28.security_opt</strong></p>
<ul>
<li>指定容器模版标签（label）机制的默认属性（用户、角色、类型、级别等）</li>
</ul>
</li>
<li><p><strong>29.stop_signal</strong></p>
<ul>
<li>设置另一个信号来停止容器，默认SIGUSR1</li>
</ul>
</li>
<li><p><strong>30.sysctls</strong></p>
<ul>
<li>配置容器内核参数</li>
</ul>
</li>
<li><p><strong>31.ulimits</strong></p>
<ul>
<li>指定容器的ulimits限制值</li>
</ul>
</li>
<li><p><strong>32.volumes</strong></p>
<ul>
<li><p>数据卷所挂载路径设置</p>
</li>
<li><p>可设置宿主机路径（HOST：CONTAINER）或加上访问模式（HOST：CONTSAINER：ro）</p>
</li>
</ul>
</li>
<li><p><strong>33.其他</strong></p>
<ul>
<li>基本与docker run中对应参数的功能一致</li>
</ul>
</li>
<li><p><strong>34.读取变量</strong></p>
<ul>
<li>Compose模版文件支持动态读取主机的系统环境变量和当前目录下的.env文件中的变量</li>
</ul>
</li>
</ul>
<h2 id="十、Docker三剑客之Machine项目"><a href="#十、Docker三剑客之Machine项目" class="headerlink" title="十、Docker三剑客之Machine项目"></a>十、Docker三剑客之Machine项目</h2><hr>
<h2 id="十一、Docker三剑客之Docker-Swarm项目"><a href="#十一、Docker三剑客之Docker-Swarm项目" class="headerlink" title="十一、Docker三剑客之Docker Swarm项目"></a>十一、Docker三剑客之Docker Swarm项目</h2><hr>
<h2 id="十二、安全"><a href="#十二、安全" class="headerlink" title="十二、安全"></a>十二、安全</h2><hr>
<h2 id="十三、底层实现"><a href="#十三、底层实现" class="headerlink" title="十三、底层实现"></a>十三、底层实现</h2><hr>

        
      
    </div>
    <div>
    
    </div>

    
    
    
      <footer class="post-footer">
          <div class="post-eof"></div>
        
      </footer>
  </article>
  
  
  

    
        
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block home" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://github.com/xx-C1/xx-C1.github.io/2019/03/10/CTFer的黑苹果安装与配置心得/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="xx_C1">
      <meta itemprop="description" content="Cyberspace Security">
      <meta itemprop="image" content="/images/dxx.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="xxC1's blog">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
            
            <a href="/2019/03/10/CTFer的黑苹果安装与配置心得/" class="post-title-link" itemprop="url">CTFer的黑苹果安装与配置心得</a>
          
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              
                
              

              <time title="创建时间：2019-03-10 19:52:06" itemprop="dateCreated datePublished" datetime="2019-03-10T19:52:06+08:00">2019-03-10</time>
            </span>
          
            

            
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2019-10-08 19:13:25" itemprop="dateModified" datetime="2019-10-08T19:13:25+08:00">2019-10-08</time>
              </span>
            
          
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/操作系统/" itemprop="url" rel="index"><span itemprop="name">操作系统</span></a></span>

                
                
              
            </span>
          

          
          <span id="busuanzi_container_page_pv">
            <span class="post-meta-divider">|</span>
            <span class="post-meta-item-icon">
            <i class="fa fa-eye"></i>
            </span>
            阅读量: <span id="busuanzi_value_page_pv"></span>次
          </span>
          <br>
            <span class="post-meta-item" title="本文字数">
              <span class="post-meta-item-icon">
                <i class="fa fa-file-word-o"></i>
              </span>
              
                <span class="post-meta-item-text">本文字数：</span>
              
              <span>5k</span>
            </span>
          
            <span class="post-meta-item" title="阅读时长">
              <span class="post-meta-item-icon">
                <i class="fa fa-clock-o"></i>
              </span>
              
                <span class="post-meta-item-text">阅读时长 &asymp;</span>
              
              <span>8 分钟</span>
            </span>
          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h5 id="0x01-前言"><a href="#0x01-前言" class="headerlink" title="0x01.前言"></a><strong>0x01.前言</strong></h5><hr>
<p> 水文一篇。 ​ 大表哥们都用Mac，小老弟还在用Win10。 自己不算忠实果粉也算半个了吧，深知苹果系统的强大、流畅、好用，着实眼红，但是又没钱买。。。所以，经先进表哥指导，搞了个黑苹果。 ​ 开学第一周，每晚在床上都是看关于黑苹果的东西，从一无所知到浅浅明白。 ​ 由于先进表哥经验丰富，过程还算顺利，一天多就搞定了。当然，中间也遇到了很多麻烦。 ​ 安装成功只是成功吃到黑苹果的一半。由Win切换到Mac，软件破解、环境配置等等更麻烦。 ​ 收获也很多。记录下来，自己加深记忆的同时也供大家参考吧。</p>
<h5 id="0x02-黑苹果安装历程"><a href="#0x02-黑苹果安装历程" class="headerlink" title="0x02.黑苹果安装历程"></a><strong>0x02.黑苹果安装历程</strong></h5><hr>
<p> 后续记忆写的，没有截图。凑合读吧。 ​ <strong>1.爬帖子爬帖子爬帖子</strong></p>
<hr>
<p> 推荐几个个不错的： ​ - 微信公众号：悦享软件（包含镜像、工具、EFI文件） ​ - 远景论坛：<code>http://bbs.pcbeta.com/</code>（主要是搜集信息，下载附件需要注册，但已经无法注册，可以淘宝买） ​ - 黑果小兵：<code>https://blog.daliansky.net/</code>（colcer工具使用及其他问题解决办法） ​ - 国光博客：<code>https://www.sqlsec.com/</code>（一名ctfer，主要是教程及安装流程） ​ 所有关于黑苹果的文章都看完之后加上观看教程视频等，基本知道大体流程及注意事项了。 ​ <strong>2.下载镜像，制启动盘</strong></p>
<hr>
<p> 使用了悦享软件分享的网盘，包含了镜像、工具、EFI大全。 ​ 链接：<code>http://mp.weixin.qq.com/s?__biz=MzIzNjAxMDMzNQ==&amp;mid=100000706&amp;idx=1&amp;sn=5bf4693ac762eae5ca63372bf7fe4c02&amp;chksm=68df2df25fa8a4e4c86fada980c07a8e2c93236e06fc0a710ce3b6049ff04b2260650287731d&amp;mpshare=1&amp;scene=23&amp;srcid=#rd</code> ​ 一开始下载的Majove（10.14），没找到10.14的光影EFI，尝试后发现用光影10.13的EFI不行。只能用High Sierra了,不过真想体验一把10.14的暗黑模式。 ​ - 格式化u盘（u盘必须要大于8G）使用工具<code>TransMac：Formar Disk for Mac</code>把u盘转换成Mac格式，一路默认就行。 ​ - 然后使用<code>Restore with Disk Image</code>把镜像写入u盘。根据u盘的存储速度来看要写入多久。（我用舍友u盘写了一个多小时….然后还不能用….坑…） ​ - 写入完成后，Win系统由于不识别Mac系统文件格式提示把u盘格式化，一定不要确定！否则前面就白费了。 ​ - 然后，根据自己电脑配置或爬帖子找到的成功案例来下载EFI文件。（EFI文件是用来引导系统开机的，下载的黑果EFI包含mac系统的引导工具CLOVER） ​ - 由于目前win无法识别mac文件格式，使用工具：<code>DiskGenius 磁盘管理软件</code>来删除u盘启动盘的/EFI/CLOVER文件夹，然后把我们下载好的EFI里的/CLOVER文件复制进去。（直接ctrl+c、ctrl+v就行） ​ 这样就完成了最重要的一步。 ​ <strong>3.开始安装</strong></p>
<hr>
<p> - 首先，开机进入BIOS把安全模式关闭（否则CLOVER无法引导开机）。然后打开usb引导开机。保存重启。 ​ - 然后选择macos install。进入，选择中文，临时开启一个macos系统。选择磁盘管理工具，选择要安装的磁盘，然后抹盘（有重要文件要备份！由于之前我win10在128G的ssd上，又不想把mac装在机械上，同时还也不想花钱换ssd..所以，我先把win10移到了机械硬盘然后抹了ssd。。。如果自己是256G的ssd在安装前，先直接分100多G就够用了） ​ - 然后再选择安装。第一次安装重启后在要安装一次。第一次安装设置macos进入系统后，基本完成了80%了。由于自己找的EFI已经可以驱动大部分，就没必要弄了。 ​ <strong>4.后续调整</strong></p>
<hr>
<p> 由于目前是用u盘来引导启动，不能每次都带个u盘来引导开启mac吧。 ​ - 然后，同样用<code>DiskGenius 磁盘管理软件</code>把u盘下的CLOVER文件复制到mac系统下ESP分区的EFI里面。 ​ - 然后，使用工具：<code>EasyUEFI</code>来新建一个开机引导，调整顺序为第一。为保障确实是第一，开机的时候可以进入BIOS看看，再设置一下。 ​ 到此，已经ok了。 ​ 然后本人有强迫症，开机引导多了很多选择，想隐藏没用的。可以在mac下挂载ESP分区，打开clover.efi文件用<code>clover configurator</code>来设置。 ​ 屏幕亮度使用键盘快捷键没法调节，但是可以用鼠标调节，暂时没管（也挺麻烦的，懒得花时间研究了，毕竟无伤大雅）。 ​ 最后，全球问题：网卡无法驱动。淘宝19.9包邮usb无线网卡解决！（苹果原装的内置网卡价格虚高，都100多。不过可以连接蓝牙。我的光影可以驱动蓝牙所以也没必要换内置网卡。） ​ <strong>5.总结一下</strong></p>
<hr>
<p> 虽然总体流程描述起来看似很简单，其实很多步骤都是看了大大大部分资料才明白的。（淘宝安装价格150一台） ​ 目前我的电脑基本90%以上完成度吧。 ​ - 无法解问题：蓝牙不能关闭、独显无法驱动、亮度无法键盘快捷键调节、触摸板部分手势不能用 ​ - 待解决问题：更换内置网卡、改显卡内存、调整字体大小（太小了累眼，改分辨率使字体变大但是模糊..） ​ - 优点：性价比极高、流畅、好用、爽、装x…… ​ - 缺点：不能100%完美、独显废了、不一定稳定、折腾…… ​ - 从win换到mac开始有点不适应…特别是快捷键。（默默掏出快捷键大全背了起来….） ​ <strong>0x03.黑苹果环境配置</strong></p>
<hr>
<p> <strong>1.xcode</strong></p>
<hr>
<p> 直接在appstore下载。 ​ 命令：<code>xcode-select --install</code>安装Xcode Command Line Tools ​ 虽然不开发苹果软件，但其内置了一些基于linux的必要工具。 ​ <strong>2..Homebrew+iTerm2+zsh</strong></p>
<hr>
<pre><code># 使用系统自带的 ruby 安装 Homebrew
/usr/bin/ruby -e &quot;$(curl -fsSL https://raw.githubusercontent.com/Homebrew/install/master/install)&quot;</code></pre><p> 不过下载速度10几k，每次都失败。网上找了一堆文章尝试后，终于解决！某国家级大型网络设备真坑！ ​ 链接：<a href="https://blog.csdn.net/qq_35624642/article/details/79682979（有两处替换，但是下载的文件只能搜到一处，所以我把第二处替换直接加上尝试竟然成功了…!）" target="_blank" rel="noopener">https://blog.csdn.net/qq_35624642/article/details/79682979（有两处替换，但是下载的文件只能搜到一处，所以我把第二处替换直接加上尝试竟然成功了…!）</a> ​ 上面文章也包括了更换国内的源，使brew更快。 ​ brew安装上后直接安装一些linux必要的工具或软件： ​ vim、git、node、python3、wget等等有的ios自带了。 ​ 都说iTerm2+zsh牛x，那给我也整一个吧。 ​ 附链接：<a href="https://www.cnblogs.com/xishuai/p/mac-iterm2.html" target="_blank" rel="noopener">https://www.cnblogs.com/xishuai/p/mac-iterm2.html</a> ​ <strong>3.IDE安装与破解</strong></p>
<hr>
<p> 我选择JetBrains全套：CLion、Pycharm、PhpStorm、Intellij IDEA、Goland ​ 下载后破解即可。在<a href="http://idea.lanyus.com/可获取破解教程（有的方法不行）" target="_blank" rel="noopener">http://idea.lanyus.com/可获取破解教程（有的方法不行）</a> ​ 尝试一番后，选择了本地破解。本地破解也不算难。由于JetBrains全家桶本地破解流程一样，索性直接把可能会用到的语言IDE全部安装了，省的以后用到再麻烦。（装这么多IDE放桌面，也zhuangb） ​ <strong>本地破解流程：</strong> ​ - 1.官网下载，打开dmg文件正常安装，在访达里面找到应用程序，显示包内容 ​ <img src="https://raw.githubusercontent.com/xx-C1/MDphoto/master/001.png" alt="001"> ​ - 2.安装完成后把破解包复制到/Contents/bin文件夹下 ​ <img src="https://raw.githubusercontent.com/xx-C1/MDphoto/master/002.png" alt="002"> ​ - 3.JetBrains全套基于Java开发，打开虚拟机设置文件xxxx.vmoptions，在最后添加一条命令： <code>-javaagent:../bin/JetbrainsIdesCrack-4.2-release.jar</code> ​ - 注：xxx是IDE的名字，添加代码的命令要和自己破解包的名字一样。 ​ <img src="https://raw.githubusercontent.com/xx-C1/MDphoto/master/003.png" alt="003"> ​ - 4.打开IDE，选择Activation code填写上面链接获取的注册码，选择ok破解完成。 ​ <img src="https://raw.githubusercontent.com/xx-C1/MDphoto/master/004.png" alt="004"> ​ <strong>4.开发环境</strong></p>
<hr>
<p> 网上有多种选择： ​ - 1.有IDE，可以直接新建build-in Web Server，即使没有Apache、Nginx就可以本地解析运行。 ​ - 2.mac自带php和apache，只需本地安装数据库（如mysql） ​ 在PhpStorm新建PhpWebPage打开Apache（提前修改配置文件把目录改成自己项目目录），然后在PhpStorm配置好默认路径即可。（也可以用其他文本编辑器） ​ mysql用<code>brew install mysql</code>即可（如果用官方dmg安装还得配置环境（和win配置环境变量一个道理），把文件地址导入到文件即可，bash是<code>~./bash_profile</code>，zsh是<code>~./zshrc</code>） ​ ​ 然后安装Nacicat可视化数据库管理软件来管理数据库。 ​ Nacicat安装与破解链接：<a href="https://blog.csdn.net/marswill/article/details/79808416" target="_blank" rel="noopener">https://blog.csdn.net/marswill/article/details/79808416</a> ​ ​ - 3.docker搭建环境，把本地代码文件映射到docker ​ docker相比来说更加灵活、省空间。但是需要熟悉docker。 ​ docker官网下载免费安装即可。 ​ ​ 总的流程分为三部： ​ - a.编写好各个软件的dockerfile ​ - b.编写好配置文件 ​ - c.通过docker-compose处理所有的dockerfile（包括将配置文件扔进dockerfile文件构建的镜像中） ​ ​ ​ <strong>5.渗透环境</strong></p>
<hr>
<p> - kali足矣 ​ <strong>6.CTF环境</strong></p>
<hr>
<p> - kali+mac+win（部分misc工具可能需要）三者切换吧 ​ <strong>7.re或pwn环境</strong></p>
<hr>
<p> 等学了用到再说吧 ​ <strong>8.其他软件</strong></p>
<hr>
<p> 免费，直接AppStore或者官网下载： ​ - 谷歌浏览器（数据同步真好） ​ - Shadowsocks（fq必备） ​ - 有道云笔记（感觉比印象笔记好用） ​ - 有道翻译（好用） ​ - Typora（写md） ​ - FDM（防断点下载，大文件下载断点就GG了） ​ - 百度网盘（限速太恶心了，网上说的Aria2GUI也不行，目前没找到防限速方法） ​ - wps（有时候还是得弄点文件、ppt啥的） ​ - Dr.Cleaner（免费清理工具，时间长了偶尔清理一下） ​ - QQ、微信 ​ ​ 需要破解： ​ - Parallels Desktop（虚拟机软件，kali很流畅！比win用vm爽多了！最牛x的是bootcamp直接可以把我机械硬盘里面的win10开启，注意：在BIOS里面开启虚拟设置） ​ - Sublime text3（主要还是写python或php的脚本和编辑用比较灵活方便） ​ - XMind（画思维导图） ​ - Dash（集成了各个语言和框架的文档手册！程序猿搬砖必备！不过全是英文…）、 ​ - 01Editor（二进制分析工具，打ctf可能会用到） ​ - PS（可能会用到，先安装破解再说） ​ 附mac精选软件链接：<a href="https://ihtcboy.com/2018/07/15/2018-07-15_%E7%A8%8B%E5%BA%8F%E5%91%98%E7%9A%84macOS%E7%B3%BB%E5%88%97%EF%BC%9A%E7%B2%BE%E9%80%89MacApp/" target="_blank" rel="noopener">https://ihtcboy.com/2018/07/15/2018-07-15_%E7%A8%8B%E5%BA%8F%E5%91%98%E7%9A%84macOS%E7%B3%BB%E5%88%97%EF%BC%9A%E7%B2%BE%E9%80%89MacApp/</a></p>
<h5 id="0x04-总结"><a href="#0x04-总结" class="headerlink" title="0x04.总结"></a><strong>0x04.总结</strong></h5><hr>
<p> 一天准备一天半安装三天配置，基本一周就过去了。。。以后好好学习，天天向上。</p>

        
      
    </div>
    <div>
    
    </div>

    
    
    
      <footer class="post-footer">
          <div class="post-eof"></div>
        
      </footer>
  </article>
  
  
  

    
        
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block home" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://github.com/xx-C1/xx-C1.github.io/2019/03/07/2018ddctf-mini-blockchain-分析/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="xx_C1">
      <meta itemprop="description" content="Cyberspace Security">
      <meta itemprop="image" content="/images/dxx.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="xxC1's blog">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
            
            <a href="/2019/03/07/2018ddctf-mini-blockchain-分析/" class="post-title-link" itemprop="url">2018DDCTF-mini-blockchain分析</a>
          
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              
                
              

              <time title="创建时间：2019-03-07 17:56:36" itemprop="dateCreated datePublished" datetime="2019-03-07T17:56:36+08:00">2019-03-07</time>
            </span>
          
            

            
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2019-10-08 20:37:35" itemprop="dateModified" datetime="2019-10-08T20:37:35+08:00">2019-10-08</time>
              </span>
            
          
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/区块链/" itemprop="url" rel="index"><span itemprop="name">区块链</span></a></span>

                
                
              
            </span>
          

          
          <span id="busuanzi_container_page_pv">
            <span class="post-meta-divider">|</span>
            <span class="post-meta-item-icon">
            <i class="fa fa-eye"></i>
            </span>
            阅读量: <span id="busuanzi_value_page_pv"></span>次
          </span>
          <br>
            <span class="post-meta-item" title="本文字数">
              <span class="post-meta-item-icon">
                <i class="fa fa-file-word-o"></i>
              </span>
              
                <span class="post-meta-item-text">本文字数：</span>
              
              <span>2.4k</span>
            </span>
          
            <span class="post-meta-item" title="阅读时长">
              <span class="post-meta-item-icon">
                <i class="fa fa-clock-o"></i>
              </span>
              
                <span class="post-meta-item-text">阅读时长 &asymp;</span>
              
              <span>4 分钟</span>
            </span>
          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>去年的题目，现在仍然开着：<a href="http://116.85.48.107:5000/b942f830cf97e/" target="_blank" rel="noopener">http://116.85.48.107:5000/b942f830cf97e/</a><br>分析一遍代码感觉对区块链又加深了理解。下一步自己尝试写一写<br>题意：银行发行了100W的DDB，黑客append两个区块转给自己99W9999。让我们找回钱并且在商店花200W买两个钻石。<br><strong>1.信息收集：</strong><br>把首页杂乱的信息整理<br><img src="https://cdn.nlark.com/yuque/0/2019/png/228594/1551521370976-b9e3ec36-1fe1-40bd-ad30-e5a43abffc30.png#align=left&display=inline&height=425&name=image.png&originHeight=531&originWidth=1370&size=114296&status=done&width=1096" alt="image.png"><br>得到信息：<br>创世区块地址<br>银行地址及资金：1<br>黑客地址及资金：999999<br>商店地址及资金：0<br><img src="https://cdn.nlark.com/yuque/0/2019/png/228594/1551521552319-188cf6a1-96a7-4f48-97a7-75e67f478255.png#align=left&display=inline&height=392&name=image.png&originHeight=490&originWidth=1294&size=77405&status=done&width=1035" alt="image.png"><br>得到信息：<br>UTXO-1：向黑客地址转资金999999<br>UTXO-2：向银行地址转资金1<br><img src="https://cdn.nlark.com/yuque/0/2019/png/228594/1551521673307-61f57cbe-fa8d-46de-a3a2-fab3c6df3fd4.png#align=left&display=inline&height=695&name=image.png&originHeight=869&originWidth=1513&size=140674&status=done&width=1210" alt="image.png"><br>得到信息：<br>创世区块高度为0，资金100W<br>黑客append空块高度为2<br><img src="https://cdn.nlark.com/yuque/0/2019/png/228594/1551521688991-a58fa40d-5b77-4526-a645-f7f1bb86cd6b.png#align=left&display=inline&height=618&name=image.png&originHeight=773&originWidth=1475&size=135938&status=done&width=1180" alt="image.png"><br>得到信息：<br>黑客把银行地址100W资金转到高度为1的区块99W9999，转到银行地址1。留下一句：HAHA, IM THE BANK NOW!<br><strong>2.源码分析</strong><br>注：为了看得更清楚，注释用的//<br><strong><img src="https://cdn.nlark.com/yuque/0/2019/png/228594/1551522047058-7976a9bc-676a-4def-bb68-f62240340fa5.png#align=left&display=inline&height=249&name=image.png&originHeight=311&originWidth=864&size=34906&status=done&width=691" alt="image.png"></strong><br>Flask框架,默认url：/b942f830cf97e<br>FLAG()函数，返回GLAG。 <strong>查看路由得到信息：</strong><br><img src="https://cdn.nlark.com/yuque/0/2019/png/228594/1551522169449-2c0dad1c-3485-443c-8570-9b02fd4a59e7.png#align=left&display=inline&height=638&name=image.png&originHeight=798&originWidth=1105&size=125089&status=done&width=884" alt="image.png"> <img src="https://cdn.nlark.com/yuque/0/2019/png/228594/1551522231974-4235add8-b1d1-46d0-a30b-2c492b4cc8d1.png#align=left&display=inline&height=190&name=image.png&originHeight=237&originWidth=1650&size=71084&status=done&width=1320" alt="image.png"><br>/默认路径下展示homepage<br>get_balance_of_all()输出所有账户余额及UTXO，及整个函数返回：创世区块、地址、UTXO、区块链、查看源码的信息<br><img src="https://cdn.nlark.com/yuque/0/2019/png/228594/1551522582257-c81edb4c-169e-4fa4-8d19-a17bed2d5f4a.png#align=left&display=inline&height=128&name=image.png&originHeight=160&originWidth=1713&size=35342&status=done&width=1370" alt="image.png"><br>/flag路径下，如果你的钻石&gt;=2调用FALG()函数输出flag。否则输出钻石不够要向商店地址转100W才得到一个钻石 <img src="https://cdn.nlark.com/yuque/0/2019/png/228594/1551523304520-55d0ac4c-4eab-4c49-b361-df9e53281296.png#align=left&display=inline&height=243&name=image.png&originHeight=303&originWidth=1202&size=70371&status=done&width=962" alt="image.png"><br>/5ecr3t_free_D1diCoin_b@ckD00r/路径下，可以在银行地址向指定地址转账。尝试一下：<br><img src="https://cdn.nlark.com/yuque/0/2019/png/228594/1551523625342-9780c892-c684-40f9-80db-6039cb08bfb7.png#align=left&display=inline&height=130&name=image.png&originHeight=162&originWidth=1194&size=141047&status=done&width=955" alt="image.png"><br>我们可以在这里知道转账的代码，可以模仿写出自己的转账代码。 <img src="https://cdn.nlark.com/yuque/0/2019/png/228594/1551523750413-bfa6b1e5-79a9-4164-a4b8-64548d848ba5.png#align=left&display=inline&height=384&name=image.png&originHeight=480&originWidth=1262&size=93046&status=done&width=1010" alt="image.png"><br>/create_transaction路径POST访问创建交易，尝试一下。看来只能用脚本了。。。怪不得题目建议用脚本。<br><img src="https://cdn.nlark.com/yuque/0/2019/png/228594/1551523996149-8c76e2b1-8f92-4a2e-8738-ffd413d89cdc.png#align=left&display=inline&height=327&name=image.png&originHeight=409&originWidth=1189&size=99215&status=done&width=951" alt="image.png"><br>然后我们可以看出代码意思：如果商店地址有100W则给你一个钻石，然后立马把商店地址的100W转到商店钱包。 <img src="https://cdn.nlark.com/yuque/0/2019/png/228594/1551524374765-51b80fba-5ef4-4958-84d3-259920793340.png#align=left&display=inline&height=138&name=image.png&originHeight=173&originWidth=885&size=30216&status=done&width=708" alt="image.png"><br>/reset路径,如果把链搞砸了可以重置区块链<br><img src="https://cdn.nlark.com/yuque/0/2019/png/228594/1551524431124-35dcc4ee-5618-443c-b7c9-5e451c30d5fd.png#align=left&display=inline&height=187&name=image.png&originHeight=234&originWidth=1299&size=34258&status=done&width=1039" alt="image.png"><br>/source_code路径，可以查看源码 在我们看路由的时候发现了很重要的信息：<br><img src="https://cdn.nlark.com/yuque/0/2019/png/228594/1551524559294-f12c7d78-d69d-4a2d-bf2a-54a44b1603d9.png#align=left&display=inline&height=29&name=image.png&originHeight=36&originWidth=537&size=4938&status=done&width=430" alt="image.png"><br>工作量证明难度要求hash值00000开头 <strong>然后审计具体函数：</strong><br><img src="https://cdn.nlark.com/yuque/0/2019/png/228594/1551524975166-4ddca8dd-d887-47a4-9c6a-8532da6e30c5.png#align=left&display=inline&height=41&name=image.png&originHeight=51&originWidth=770&size=8344&status=done&width=616" alt="image.png"><br>计算参数hash摘要信息。而且是先md5再sha256,更加加固了信息摘要安全性。 <img src="https://cdn.nlark.com/yuque/0/2019/png/228594/1551525066462-7ef69387-5b8c-4dcf-a0d3-b5ff15527e40.png#align=left&display=inline&height=38&name=image.png&originHeight=48&originWidth=722&size=7140&status=done&width=578" alt="image.png"><br>哈希运算，我们定位使用该函数的地方，可以看到是python的reduce()函数调用，该函数是对第一个参数(函数)运算后的值与第二个参数运算。在区块链中应该是来更容易计算：父区块hash+本区块hash+随机数<br>reduce函数使用规则可以参考一下链接：<a href="http://www.runoob.com/python/python-func-reduce.html" target="_blank" rel="noopener">http://www.runoob.com/python/python-func-reduce.html</a><br><img src="https://cdn.nlark.com/yuque/0/2019/png/228594/1551525505480-82b5d26d-2775-4572-ad18-2d32ea3811b7.png#align=left&display=inline&height=40&name=image.png&originHeight=50&originWidth=952&size=11496&status=done&width=762" alt="image.png"><br><img src="https://cdn.nlark.com/yuque/0/2019/png/228594/1551525515489-d50f99fa-be8e-45a5-afe1-bfe563b9aa30.png#align=left&display=inline&height=104&name=image.png&originHeight=130&originWidth=964&size=22798&status=done&width=771" alt="image.png"><br><img src="https://cdn.nlark.com/yuque/0/2019/png/228594/1551525543361-260e6338-0a43-49d7-8a6c-a3e17d451eb3.png#align=left&display=inline&height=39&name=image.png&originHeight=49&originWidth=1588&size=17353&status=done&width=1270" alt="image.png"><br>定位调用reduce的函数找到，这三个函数直接返回reduce函数的计算值，来计算UTXO、TX、Block的hash值。 <img src="https://cdn.nlark.com/yuque/0/2019/png/228594/1551525675024-b0f93ad3-1d7d-4909-92df-9d956c214cf5.png#align=left&display=inline&height=97&name=image.png&originHeight=121&originWidth=973&size=23230&status=done&width=778" alt="image.png"><br>来限制格式必须是字典容器模型格式或JSON格式，如果attrs参数中所有值有没在d参数中的则抛出异常。<br>定位一下使用has_attrs()函数的地方:<br><img src="https://cdn.nlark.com/yuque/0/2019/png/228594/1551526014384-65ca72f1-716f-4020-be1b-8a2666499e07.png#align=left&display=inline&height=62&name=image.png&originHeight=77&originWidth=701&size=15090&status=done&width=561" alt="image.png"><br>在添加块中要求block必须有三元素：前一区块hash值、nonce值、汇报<br><img src="https://cdn.nlark.com/yuque/0/2019/png/228594/1551526070831-d9e5add9-f706-47fa-9628-69db5069827b.png#align=left&display=inline&height=42&name=image.png&originHeight=52&originWidth=724&size=8710&status=done&width=579" alt="image.png"><br>在交易中必须有：输入、输出、签名<br><img src="https://cdn.nlark.com/yuque/0/2019/png/228594/1551526174262-32d15ab3-0c9e-4da6-89e9-a40e1bf1d771.png#align=left&display=inline&height=45&name=image.png&originHeight=56&originWidth=702&size=9530&status=done&width=562" alt="image.png"><br>在UTXO中必须有：资金数量、地址、id值 所以我们可以知道各个字段的包含关系：<br><img src="https://cdn.nlark.com/yuque/0/2019/png/228594/1551601326385-57d8689a-2f61-46bd-8ed6-24caabeb90f2.png#align=left&display=inline&height=281&name=image.png&originHeight=351&originWidth=765&size=31119&status=done&width=612" alt="image.png"> <img src="https://cdn.nlark.com/yuque/0/2019/png/228594/1551526265333-4d652d77-7de9-4021-98d1-1acbb454d3bc.png#align=left&display=inline&height=22&name=image.png&originHeight=27&originWidth=367&size=2839&status=done&width=294" alt="image.png"><br>常量hash值，64个0。在计算hash值得时候用到<br><img src="https://cdn.nlark.com/yuque/0/2019/png/228594/1551526407641-120a6963-e8cf-4a53-b63c-06e24f76ae9a.png#align=left&display=inline&height=82&name=image.png&originHeight=103&originWidth=351&size=20449&status=done&width=281" alt="image.png"><br>在python中验证一下字符串*数字结果。 <img src="https://cdn.nlark.com/yuque/0/2019/png/228594/1551527499587-d0fdbb5a-f2f8-4a07-b4ae-a80a9a998f1d.png#align=left&display=inline&height=55&name=image.png&originHeight=69&originWidth=672&size=12863&status=done&width=538" alt="image.png">  </p>
<p>地址是N，65537是e，返回地址的私钥d（RSA参数，不懂可百度）来验证。 <img src="https://cdn.nlark.com/yuque/0/2019/png/228594/1551527696583-f108e95e-8d92-47ba-b634-a3ac6f908402.png#align=left&display=inline&height=166&name=image.png&originHeight=207&originWidth=707&size=35615&status=done&width=566" alt="image.png"><br>生成钱包地址(公钥)及私钥。 <img src="https://cdn.nlark.com/yuque/0/2019/png/228594/1551527893365-71b0b0f4-98a3-423d-8e46-d7f400df7a93.png#align=left&display=inline&height=42&name=image.png&originHeight=53&originWidth=785&size=12100&status=done&width=628" alt="image.png"><br>签名函数，把交易信息用私钥加密得到签名摘要。 <img src="https://cdn.nlark.com/yuque/0/2019/png/228594/1551527987853-e33c2a42-b016-4ead-b090-38b3860eb273.png#align=left&display=inline&height=96&name=image.png&originHeight=120&originWidth=828&size=19791&status=done&width=662" alt="image.png"><br>创建一个交易输出，参数为目的地址和资金数量 <img src="https://cdn.nlark.com/yuque/0/2019/png/228594/1551528145287-f03fa944-7048-489a-b91a-9952586f5ab4.png#align=left&display=inline&height=78&name=image.png&originHeight=98&originWidth=1458&size=24271&status=done&width=1166" alt="image.png"><br>创建一个交易，其中签名为把交易id通过私钥加密 <img src="https://cdn.nlark.com/yuque/0/2019/png/228594/1551596891043-7184dc2e-d317-42f0-b1a1-5b0fe82ac32a.png#align=left&display=inline&height=147&name=image.png&originHeight=184&originWidth=1225&size=44464&status=done&width=980" alt="image.png"><br>创建一个区块，包括三要素：前一区块hash值、nonce值、汇报。前一区块hash值必须是16进制且限制nonce长度要小于128。<br><img src="https://cdn.nlark.com/yuque/0/2019/png/228594/1551597071521-9f46d96b-0240-4b3b-8ba6-d750e90f449f.png#align=left&display=inline&height=60&name=image.png&originHeight=75&originWidth=938&size=16845&status=done&width=750" alt="image.png"><br>查找区块链中最后一个区块,返回其高度？ <img src="https://cdn.nlark.com/yuque/0/2019/png/228594/1551597278446-28d7c387-3838-4967-9a21-b04e50d7de34.png#align=left&display=inline&height=288&name=image.png&originHeight=360&originWidth=734&size=52993&status=done&width=587" alt="image.png"><br>获取所有的UTXO信息 <img src="https://cdn.nlark.com/yuque/0/2019/png/228594/1551597444258-c50d45d4-7109-47eb-b5a3-e262f1077ed4.png#align=left&display=inline&height=145&name=image.png&originHeight=181&originWidth=783&size=30846&status=done&width=626" alt="image.png"><br>计算钱包的余额。默认三个地址都为0，循环累加UTXO中每个地址的资金，返回各个地址的余额。 <img src="https://cdn.nlark.com/yuque/0/2019/png/228594/1551597603049-4ee04991-4585-45b2-8e65-e7056a66d77a.png#align=left&display=inline&height=110&name=image.png&originHeight=137&originWidth=966&size=23400&status=done&width=773" alt="image.png"><br>验证UTXO签名。其实就是rsa的解密过程。签名为密文，地址为公钥，解密算出明文（信息摘要）正确，则证明了是交易人地址验证签名正确。 <img src="https://cdn.nlark.com/yuque/0/2019/png/228594/1551599022114-687146e1-f1eb-4ac1-b8a9-a16a9e41f8a4.png#align=left&display=inline&height=566&name=image.png&originHeight=708&originWidth=1449&size=173166&status=done&width=1159" alt="image.png"><br><img src="https://cdn.nlark.com/yuque/0/2019/png/228594/1551599033582-b0bba9cc-1066-493c-b4f2-d04f3ab37333.png#align=left&display=inline&height=498&name=image.png&originHeight=623&originWidth=1675&size=190192&status=done&width=1340" alt="image.png"><br>添加区块，过程略微复杂，主要是验证添加的区块是否满足规范，否则抛出异常。<br>大致过程如下：<br>1.验证三要素。(第三要素”交易”又有输入、输出（输出即UTXO又包含id值、资金数量、地址）、签名)。包括验证输出要小于输入等等可能出现问题的地方。<br>2.创建区块（包含三要素），产生区块hash。保证区块hash值满足规范但又小于difficulty值。<br>3.区块链高度加一，且长度不能超过50。 <img src="https://cdn.nlark.com/yuque/0/2019/png/228594/1551600598632-2a33fe79-ebcc-4445-92a3-30a77274d24a.png#align=left&display=inline&height=432&name=image.png&originHeight=540&originWidth=1576&size=123344&status=done&width=1261" alt="image.png"><br>设置session，有区块和我们的钻石数。首先产生创世区块100W资金，然后银行被黑客添加区块转账99W9999，黑客又添加了空块。 <img src="https://cdn.nlark.com/yuque/0/2019/png/228594/1551600852134-00addc22-5b18-413a-bda4-5fe9c44212cd.png#align=left&display=inline&height=123&name=image.png&originHeight=154&originWidth=731&size=22862&status=done&width=585" alt="image.png"><br>得到所有信息函数。在主页调用了，我们看到的主页信息就是调用了该函数。 <strong>3.构造思路</strong><br>由于没有别人来挖矿（添加区块）即我们拥有100%算力。可以结合51%算力攻击，我们可以随意添加区块来改变主链方向。同时也可利用双花攻击来达到双次花费。<br>初始信息：<br><img src="https://cdn.nlark.com/yuque/0/2019/png/228594/1551602218697-285b1ed7-a7b4-4310-8f8d-de52c60ebb22.png#align=left&display=inline&height=153&name=image.png&originHeight=191&originWidth=651&size=16328&status=done&width=521" alt="image.png"><br>通过append区块把钱找回：<br><img src="https://cdn.nlark.com/yuque/0/2019/png/228594/1551602593555-90e5c7ed-79aa-4aca-84d5-614b2d7dc607.png#align=left&display=inline&height=294&name=image.png&originHeight=367&originWidth=682&size=37302&status=done&width=546" alt="image.png"><br>同时我们关注代码部分，shop会立即把钱转到shop钱包<br><img src="https://cdn.nlark.com/yuque/0/2019/png/228594/1551602786797-adecaef9-27cc-4be1-9e94-692514579f39.png#align=left&display=inline&height=72&name=image.png&originHeight=90&originWidth=903&size=45436&status=done&width=722" alt="image.png"><br>即目前情况为：<br><img src="https://cdn.nlark.com/yuque/0/2019/png/228594/1551602842623-aaf88348-d1b8-4407-83f7-113ec827551c.png#align=left&display=inline&height=301&name=image.png&originHeight=376&originWidth=832&size=44032&status=done&width=666" alt="image.png"><br>那么我们就可以再次分叉来发动双花攻击了。<br><img src="https://cdn.nlark.com/yuque/0/2019/png/228594/1551602978875-94e2fab5-0782-4820-a650-d38983c5304a.png#align=left&display=inline&height=378&name=image.png&originHeight=472&originWidth=1124&size=63166&status=done&width=899" alt="image.png">  </p>
<p>此时主链已经成为：1-2(2)-3(2)-4(2)-5(3)-6(3)已经覆盖shop把钱转到自己钱包，100W又到了shop所有又获得1个钻石。 <strong>4.Payload脚本</strong><br>参考：一叶飘零师傅 <img src="https://cdn.nlark.com/yuque/0/2019/png/228594/1551603349814-3856c6bf-ddc8-41ed-90b6-532b1177cca1.png#align=left&display=inline&height=462&name=image.png&originHeight=578&originWidth=873&size=84230&status=done&width=698" alt="image.png"><br>获取初始session，抓取主页信息。<br><img src="https://cdn.nlark.com/yuque/0/2019/png/228594/1551603413886-11a53e94-b9b1-49a3-b251-f113be451c9a.png#align=left&display=inline&height=380&name=image.png&originHeight=475&originWidth=977&size=61096&status=done&width=782" alt="image.png"><br>贴一下源码中的函数及常量，以便我们使用。<br><img src="https://cdn.nlark.com/yuque/0/2019/png/228594/1551603398187-2d7facae-baa1-4e59-b334-f72d2a02ff8f.png#align=left&display=inline&height=184&name=image.png&originHeight=230&originWidth=574&size=28837&status=done&width=459" alt="image.png"><br>写好挖矿脚本，爆破遍历nonce满足小于difficulty且’00000’开头<br><img src="https://cdn.nlark.com/yuque/0/2019/png/228594/1551603533197-1f5d5edb-ad30-4163-915d-18fca78e7f66.png#align=left&display=inline&height=456&name=image.png&originHeight=570&originWidth=1458&size=121080&status=done&width=1166" alt="image.png"><br>添加第一个自己的区块，注意header的构造：添加Content-Type为json。<br><img src="https://cdn.nlark.com/yuque/0/2019/png/228594/1551603578228-2dc94f6a-4b16-4556-9b9e-ef2320407c49.png#align=left&display=inline&height=511&name=image.png&originHeight=639&originWidth=1019&size=159286&status=done&width=815" alt="image.png"><br>按照思路逐个提交构造的区块，然后再访问/flag目录即可得到falg。<br><img src="https://cdn.nlark.com/yuque/0/2019/png/228594/1551603701071-5d74cf0a-aa29-46c5-9bee-45b7c45db3a6.png#align=left&display=inline&height=262&name=image.png&originHeight=327&originWidth=1281&size=45246&status=done&width=1025" alt="image.png"></p>

        
      
    </div>
    <div>
    
    </div>

    
    
    
      <footer class="post-footer">
          <div class="post-eof"></div>
        
      </footer>
  </article>
  
  
  

    
        
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block home" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://github.com/xx-C1/xx-C1.github.io/2019/02/25/比特币理论基础笔记/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="xx_C1">
      <meta itemprop="description" content="Cyberspace Security">
      <meta itemprop="image" content="/images/dxx.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="xxC1's blog">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
            
            <a href="/2019/02/25/比特币理论基础笔记/" class="post-title-link" itemprop="url">比特币理论基础笔记</a>
          
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              
                
              

              <time title="创建时间：2019-02-25 16:54:40" itemprop="dateCreated datePublished" datetime="2019-02-25T16:54:40+08:00">2019-02-25</time>
            </span>
          
            

            
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2019-10-08 19:11:27" itemprop="dateModified" datetime="2019-10-08T19:11:27+08:00">2019-10-08</time>
              </span>
            
          
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/区块链/" itemprop="url" rel="index"><span itemprop="name">区块链</span></a></span>

                
                
              
            </span>
          

          
          <span id="busuanzi_container_page_pv">
            <span class="post-meta-divider">|</span>
            <span class="post-meta-item-icon">
            <i class="fa fa-eye"></i>
            </span>
            阅读量: <span id="busuanzi_value_page_pv"></span>次
          </span>
          <br>
            <span class="post-meta-item" title="本文字数">
              <span class="post-meta-item-icon">
                <i class="fa fa-file-word-o"></i>
              </span>
              
                <span class="post-meta-item-text">本文字数：</span>
              
              <span>1.7k</span>
            </span>
          
            <span class="post-meta-item" title="阅读时长">
              <span class="post-meta-item-icon">
                <i class="fa fa-clock-o"></i>
              </span>
              
                <span class="post-meta-item-text">阅读时长 &asymp;</span>
              
              <span>3 分钟</span>
            </span>
          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h5 id="一、概念"><a href="#一、概念" class="headerlink" title="一、概念"></a>一、概念</h5><p>2008年中本聪发明比特币 1.微观：数字货币，其价值来源于人对其的信任和共识。 2.宏观：去中心化的记账系统</p>
<hr>
<h5 id="二、比特币特点"><a href="#二、比特币特点" class="headerlink" title="二、比特币特点"></a>二、比特币特点</h5><p>1.财产只受自己控制（银行可以认为你的钱不合法而收缴，而比特币只有自己的私钥控制） 2.无通货膨胀（比特币总量2100万个不变，不会贬值） 3.无假钞（共识机制） 4.流通性好（点对点） 5.不可篡改（去中心化） 6.隐私性（无个人信息）</p>
<hr>
<h5 id="三、比特币原理"><a href="#三、比特币原理" class="headerlink" title="三、比特币原理"></a>三、比特币原理</h5><p><strong>1.账本如何验证？</strong> ①与所有人的账本一一核对（效率低，方案不通） ②Hash（上一个区块的Hash+本区块信息），则只需要核对最后一个区块的hash值就可以验证账本 <strong>哈希函数：</strong>MD5、SHA1、SHA256 <strong>哈希函数特点：</strong> ①同样原始信息用同一个哈希函数总能得到相同的摘要信息 ②原始信息任何微小的变化都会哈希出面目全非的摘要信息 ③从摘要信息无法逆向推算出原始信息，即单向函数 哈希函数主要用途：验证文件是否被修改 <strong>2.账户的所有权问题？</strong> <strong>比特币地址</strong> <strong>私钥：谁拥有私钥谁就拥有比特币地址，即拥有支付权</strong> 比特币地址和私钥是一个非对称关系，私钥通过hash运算可以得到比特币地址，但是不能通过比特币地址逆向推算私钥。 <img src="https://raw.githubusercontent.com/xx-C1/MDphoto/master/1551084140086.png" alt="1551084140086"> <strong>账户的所有权问题变为：不泄漏私钥的情况下证明拥有某个比特币地址的私钥？答：非对称加密技术</strong> <strong>交易签名：</strong> ①交易进行hash得到摘要信息 <img src="https://raw.githubusercontent.com/xx-C1/MDphoto/master/1551084305692.png" alt="1551084305692"> ②用摘要信息和私钥进行签名运算得到签名信息 <img src="https://raw.githubusercontent.com/xx-C1/MDphoto/master/1551084176333.png" alt="1551084176333"> <strong>签名（加密）信息后，再广播签名信息和原始交易记录，再通过非对称密码技术验证（解密），验证通过后添加该区块。</strong> <img src="https://raw.githubusercontent.com/xx-C1/MDphoto/master/1551084191076.png" alt="1551084191076"> <strong>签名就是加密，验证就是解密。</strong> <img src="https://raw.githubusercontent.com/xx-C1/MDphoto/master/1551084202365.png" alt="1551084202365"> <strong>3.为什么记账？（同时也是比特币发行的过程）</strong> <strong>记账规则：</strong> ①一段时间内只有一个人可以记帐成功 ②通过解决密码学难题（即工作量证明，即挖矿）竞争获得唯一记账权（直接验证hash值谁都可以记账，所以引入工作量证明机制） ③其他节点复制记账结果 <strong>工作量证明：</strong>通过爆破随机数，找到满足规则随机数后则得到唯一记账权 <img src="https://raw.githubusercontent.com/xx-C1/MDphoto/master/1551084216791.png" alt="1551084216791"> 过程计算量很大，目前已经没有单独矿工挖矿。一般都是矿工组合成矿池，通过算力比来分成收益。过程非常耗电，所以从经济学角度只要有收益就会有矿工加入挖矿，最终会达到挖矿成本接近收益。 <strong>交易记录集：</strong> ①收集广播中还没有被记录账本的交易 ②交易的有效性验证 ③添加一笔给自己转账的交易（挖矿奖励） <strong>4.两个节点同时完成工作量证明（分叉），使用谁的区块？共识机制（选择累计工作量最大的区块，最长的链为主链）</strong> 由于网络不确定性会产生孤块</p>
<hr>
<h5 id="四、比特币工作流程"><a href="#四、比特币工作流程" class="headerlink" title="四、比特币工作流程"></a>四、比特币工作流程</h5><p><strong>1.</strong>节点分为：①发送节点②接收节点 发送节点在比特币体系里就是用于提交交易信息的用户。接收节点在比特币体系里面就是通常指矿工。 如果有新的交易要提交，那么发送节点就会在比特币网络进行交易信息的广播。矿工则要一直监听比特币网络里是否有交易广播。 <strong>2.</strong>矿工收到广播的交易信息后，需要校验这个信息的签名等内容是否合法。如果校验通过后，就需要将收到的所有交易信息按照一定的规则组装成一个数据块，也就是区块。 <strong>3.</strong>刚刚组装的区块还只是在自己这里，还未被纳入比特币网络中正式的区块链中。 如何才能被正式纳入呢？这里就涉及到共识算法了。 因为每个矿工都可能组装了自己的区块，在每10分钟之内，只可能有一个区块被纳入正式区块链，那么所有的矿工就要根据规则在最短的时间内使自己的区块被其它矿工认可，谁最先做到，那么谁的区块就会被正式纳入。 <strong>4.</strong>能纳入区块链的规则就是共识算法，比特币中使用的共识算法是工作量证明法。即让所有的矿工都去寻找一个随机数，这个随机数是通过Hash算法算出来的，并且算出来的随机数需要满足一定的条件才是大家认可的随机数（需要满足该随机数能使整个区块的哈希值小于目标值），谁先计算/猜到这个随机数，它的区块就能被全网接受。 <strong>5.</strong>然后这个区块就可以纳入正式区块链，放到链条的最后面，然后各个节点再开始挖下一个区块，就这么一直接连接下去。 <strong>6.</strong>挖到有效区块的节点可以获得奖励，这个奖励主要有2部分组成： ①比特币体系约定每挖到一个有效区块奖励25比特币。 ②交易手续费。（交易信息的提交节点需要以比特币形式付这一笔交易手续费）</p>

        
      
    </div>
    <div>
    
    </div>

    
    
    
      <footer class="post-footer">
          <div class="post-eof"></div>
        
      </footer>
  </article>
  
  
  

    
        
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block home" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://github.com/xx-C1/xx-C1.github.io/2019/02/24/区块链理论基础整理/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="xx_C1">
      <meta itemprop="description" content="Cyberspace Security">
      <meta itemprop="image" content="/images/dxx.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="xxC1's blog">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
            
            <a href="/2019/02/24/区块链理论基础整理/" class="post-title-link" itemprop="url">区块链理论基础整理</a>
          
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              
                
              

              <time title="创建时间：2019-02-24 21:45:33" itemprop="dateCreated datePublished" datetime="2019-02-24T21:45:33+08:00">2019-02-24</time>
            </span>
          
            

            
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2019-10-08 19:12:49" itemprop="dateModified" datetime="2019-10-08T19:12:49+08:00">2019-10-08</time>
              </span>
            
          
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/区块链/" itemprop="url" rel="index"><span itemprop="name">区块链</span></a></span>

                
                
              
            </span>
          

          
          <span id="busuanzi_container_page_pv">
            <span class="post-meta-divider">|</span>
            <span class="post-meta-item-icon">
            <i class="fa fa-eye"></i>
            </span>
            阅读量: <span id="busuanzi_value_page_pv"></span>次
          </span>
          <br>
            <span class="post-meta-item" title="本文字数">
              <span class="post-meta-item-icon">
                <i class="fa fa-file-word-o"></i>
              </span>
              
                <span class="post-meta-item-text">本文字数：</span>
              
              <span>4.2k</span>
            </span>
          
            <span class="post-meta-item" title="阅读时长">
              <span class="post-meta-item-icon">
                <i class="fa fa-clock-o"></i>
              </span>
              
                <span class="post-meta-item-text">阅读时长 &asymp;</span>
              
              <span>7 分钟</span>
            </span>
          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h4 id="一、历史"><a href="#一、历史" class="headerlink" title="一、历史"></a>一、历史</h4><p> 密码朋克（cypherpunk）（包含很多密码学家大佬） ​ 2008年中本聪发明比特币 ​ 1.微观：数字货币，其价值来源于人对其的信任和共识。 ​ 2.宏观：去中心化的记账系统</p>
<hr>
<h4 id="二、区块链是什么"><a href="#二、区块链是什么" class="headerlink" title="二、区块链是什么"></a>二、区块链是什么</h4><p> 区块链本质就是一个分布式数据库。（该数据库由一串使用密码学方法产生的数据区块有序链接而成，区块中包含有一定时间内产生的无法被篡改的数据记录信息） ​ 数据库记录的内容可以因应具体的业务而变化，没有特殊的设定。网络上每一个节点都有一个全量的数据库副本，每一个节点都可以写入数据，并将数据同步到其它节点中去。 ​ 区块链之所以叫区块链，是因为它由区块和链表组成。每个区块都包含2部分：</p>
<h5 id="1-区块头"><a href="#1-区块头" class="headerlink" title="1.区块头"></a>1.区块头</h5><p> 区块头记录了其父区块的哈希值、本区块的哈希值和生成时间等信息。每一个区块的哈希值都是不一样的，根据其区块体的内容和上一个区块的哈希值生成。</p>
<h5 id="2-区块体"><a href="#2-区块体" class="headerlink" title="2.区块体"></a>2.区块体</h5><p> 区块体记录的就是具体的业务数据。（比特币为例，其区块体记录了比特币网络中发生的每一笔交易数据。） ​ 可以对区块体的内容进行加密，保证数据只公开给有访问权限的人。 ​ 每个区块都有一个父区块的指针，就形成了区块链。</p>
<hr>
<h4 id="三、区块链能做什么"><a href="#三、区块链能做什么" class="headerlink" title="三、区块链能做什么"></a>三、区块链能做什么</h4><p> 如果区块链只是一个分布式的数据库。区别于其他数据库，其最大的特点就是去中心化。 ​ 传统的数据库都是主从的模式，读操作在从库完成，写操作都是在主库完成，主库就是一个中心化的库。而区块链在每一个节点都能进行写操作，没有一个中心化的库存在。再结合上文提到的防篡改的特性，区块链有很高的置信度。就算某个节点被黑客攻破，也不会影响到其它节点。而中心化的数据库一旦主库被黑或者被管理员删库，就GG了。 ​ 基于区块链极高的置信度和可靠性，所有交易类的场景都能应用上。目前用的最广泛的就是数字货币。在其它小范围的商业场景下，也会利用区块链做一些商业联盟之间的业务。比如金融行业，保险公司跟银行之间的委托保险买卖业务；供应链各个环节的数据追踪；数字化作品的版权确认等。</p>
<hr>
<h4 id="四、区块链不能做什么"><a href="#四、区块链不能做什么" class="headerlink" title="四、区块链不能做什么"></a>四、区块链不能做什么</h4><p> 因为区块链是一个分布式的数据库，就涉及到数据的同步问题。而将新的数据同步到全网是一个非常耗时的过程。以比特币为例，确认一笔交易平均需要1个小时的时间。另外，区块链也不擅长处理高并发的业务。目前来说，其每秒最多也只能并发处理500个请求。所以对于实时性要求高的业务，区块链并不合适。</p>
<hr>
<h4 id="五、区块链特性"><a href="#五、区块链特性" class="headerlink" title="五、区块链特性"></a>五、区块链特性</h4><h5 id="1-去中心化"><a href="#1-去中心化" class="headerlink" title="1.去中心化"></a>1.去中心化</h5><p> 区块链在每一个节点都能进行写操作，没有一个中心化的库存在。</p>
<h5 id="2-不可伪造"><a href="#2-不可伪造" class="headerlink" title="2.不可伪造"></a>2.不可伪造</h5><h5 id="3-不可篡改"><a href="#3-不可篡改" class="headerlink" title="3.不可篡改"></a>3.不可篡改</h5><p> 由于各个区块根据区块的哈希值串联起来，而区块的哈希值是根据区块体的内容和上一个区块的哈希值而生成的。一旦对区块的内容进行了更改，哈希值就会改变。这会导致它子区块的哈希值会跟着变，一直传导到各个子孙区块。如果没有51%的节点配合，这种篡改是不可能生效的。</p>
<h5 id="4-不可复制"><a href="#4-不可复制" class="headerlink" title="4.不可复制"></a>4.不可复制</h5><h5 id="5-匿名"><a href="#5-匿名" class="headerlink" title="5.匿名"></a>5.匿名</h5><h5 id="6-基于密码学"><a href="#6-基于密码学" class="headerlink" title="6.基于密码学"></a>6.基于密码学</h5><h5 id="7-分布式"><a href="#7-分布式" class="headerlink" title="7.分布式"></a>7.分布式</h5><h5 id="8-可溯源"><a href="#8-可溯源" class="headerlink" title="8.可溯源"></a>8.可溯源</h5><h5 id="9-账本公开"><a href="#9-账本公开" class="headerlink" title="9.账本公开"></a>9.账本公开</h5><hr>
<h4 id="六、区块链缺点"><a href="#六、区块链缺点" class="headerlink" title="六、区块链缺点"></a>六、区块链缺点</h4><h5 id="1-效率"><a href="#1-效率" class="headerlink" title="1.效率"></a>1.效率</h5><p> 数据写入区块链，最少要等待十分钟，所有节点都同步数据，则需要更多的时间。</p>
<h5 id="2-能耗"><a href="#2-能耗" class="headerlink" title="2.能耗"></a>2.能耗</h5><p> 区块的生成需要矿工进行无数无意义的计算，非常耗费能源。 ​ 因此，区块链的适用场景，其实非常有限。 ​ 1.不存在所有成员都信任的管理当局 ​ 2.写入的数据不要求实时使用 ​ 3.挖矿的收益能够弥补本身的成本</p>
<hr>
<h4 id="七、区块链类型"><a href="#七、区块链类型" class="headerlink" title="七、区块链类型"></a>七、区块链类型</h4><h5 id="根据网络范畴："><a href="#根据网络范畴：" class="headerlink" title="根据网络范畴："></a>根据网络范畴：</h5><h5 id="1-共有链"><a href="#1-共有链" class="headerlink" title="1.共有链"></a>1.共有链</h5><p> 特点：完全对外开放，任何人都可以任意使用，没有权限的限定，没有身份认证，不但可以任意参与使用，而且发生的所有数据都可以任意查看，完全公开透明。 ​ 例子：比特币、EOS、eth、NEO</p>
<h5 id="2-私有链"><a href="#2-私有链" class="headerlink" title="2.私有链"></a>2.私有链</h5><p> 特点：不对外开放，仅在组织内部使用。需要提交身份认证，而且具备一套权限管理体系。 ​ 例子：企业的票据管理、财务审计、供应链管理</p>
<h5 id="3-联盟链"><a href="#3-联盟链" class="headerlink" title="3.联盟链"></a>3.联盟链</h5><p> 特点：联盟链的网络范围结余共有链和私有链之间，通常是使用在多个成员角色的环境下。往往由不同权限的成员 参与，一般也是具有身份认证和权限设置。 ​ 例子：R3CV、IBM farbric、</p>
<h5 id="4-主流项目"><a href="#4-主流项目" class="headerlink" title="4.主流项目"></a>4.主流项目</h5><h5 id="根据部署环境："><a href="#根据部署环境：" class="headerlink" title="根据部署环境："></a>根据部署环境：</h5><h5 id="1-主链"><a href="#1-主链" class="headerlink" title="1.主链"></a>1.主链</h5><p> 最长的链。部署在生产环境中真正的区块链系统，只有主链才会真正被推广使用，各项功能的设计都相对完善。</p>
<h5 id="2-测试链"><a href="#2-测试链" class="headerlink" title="2.测试链"></a>2.测试链</h5><p> 测试用，可更改算法测试。</p>
<h5 id="根据对接类型："><a href="#根据对接类型：" class="headerlink" title="根据对接类型："></a>根据对接类型：</h5><h5 id="1-单链"><a href="#1-单链" class="headerlink" title="1.单链"></a>1.单链</h5><p> 能够单独运行的区块链系统</p>
<h5 id="2-侧链"><a href="#2-侧链" class="headerlink" title="2.侧链"></a>2.侧链</h5><p> 将不同的链结合起来的区块链。侧链能起到一个对主链功能扩展的作用，很多在主链中不方便实现的功能可以在侧链中实现，而侧链再通过与主链数据交互增强自己的可靠性。</p>
<h5 id="3-互联链"><a href="#3-互联链" class="headerlink" title="3.互联链"></a>3.互联链</h5><p> 各个区块链互联。类似互联网。</p>
<hr>
<h4 id="八、区块链架构"><a href="#八、区块链架构" class="headerlink" title="八、区块链架构"></a>八、区块链架构</h4><h5 id="v1-0"><a href="#v1-0" class="headerlink" title="v1.0"></a>v1.0</h5><p> 比特币 ​ <img src="https://raw.githubusercontent.com/xx-C1/MDphoto/master/1551015130442.png" alt="1551015130442"></p>
<h5 id="v2-0"><a href="#v2-0" class="headerlink" title="v2.0"></a>v2.0</h5><p> 以太坊、智能合约、eth（主要与金融领域结合） <img src="https://raw.githubusercontent.com/xx-C1/MDphoto/master/1551015156447.png" alt="1551015156447"> ​ v2.0最大的特点就是支持智能合约。在以太坊中，使用智能合约开发工具开发合约程序，并且编译为字节码，最终部署到以太坊的区块链账本中。部署后的智能合约是运行在虚拟机上的，成为“以太坊虚拟机”。正式通过这样的智能合约的实现，扩展了区块链系统的功能。</p>
<h5 id="v3-0"><a href="#v3-0" class="headerlink" title="v3.0"></a>v3.0</h5><p> 社会、物联网、存储（区块链与各个行业融合） <img src="https://raw.githubusercontent.com/xx-C1/MDphoto/master/1551015167298.png" alt="1551015167298"> ​ 超越了对数字货币或者金融的应用范畴，而将区块链技术作为一种泛解决方案，可以在其他领域使用，比如行政管理、文化艺术、企业供应链、医疗健康、物联网、产权登记等，可以认为是面向行业应用。 ​ 行业应用一般是需要具备企业级属性（比如身份认证、许可授权、加密传输等）并且对数据的处理性能也会有要求，因此企业级场景下的应用，往往都是联盟链或者私有链。</p>
<hr>
<h4 id="九、区块链协议分层"><a href="#九、区块链协议分层" class="headerlink" title="九、区块链协议分层"></a>九、区块链协议分层</h4><h5 id="6-应用层"><a href="#6-应用层" class="headerlink" title="6.应用层"></a>6.应用层</h5><p> 转账和记账等功能</p>
<h5 id="5-合约层"><a href="#5-合约层" class="headerlink" title="5.合约层"></a>5.合约层</h5><p> 基本代码 ​ 算法机制 ​ 智能合约</p>
<h5 id="4-激励机制"><a href="#4-激励机制" class="headerlink" title="4.激励机制"></a>4.激励机制</h5><p> 发行机制 ​ 分配机制</p>
<h5 id="3-共识层"><a href="#3-共识层" class="headerlink" title="3.共识层"></a>3.共识层</h5><p> POW ​ POS ​ DPOS ​ DBFT ​ 其他</p>
<h5 id="2-网络层"><a href="#2-网络层" class="headerlink" title="2.网络层"></a>2.网络层</h5><p> p2p网络 ​ 传播机制 ​ 验证机制</p>
<h5 id="1-数据层"><a href="#1-数据层" class="headerlink" title="1.数据层"></a>1.数据层</h5><p> 区块数据 ​ 链式结构 ​ 数字签名 ​ 哈希函数 ​ Merkel树 ​ 非对称加密</p>
<hr>
<h4 id="十、区块链工作流程步骤"><a href="#十、区块链工作流程步骤" class="headerlink" title="十、区块链工作流程步骤"></a>十、区块链工作流程步骤</h4><h5 id="1-发送节点将新的数据记录向全网广播"><a href="#1-发送节点将新的数据记录向全网广播" class="headerlink" title="1.发送节点将新的数据记录向全网广播"></a>1.发送节点将新的数据记录向全网广播</h5><h5 id="2-接收节点对收到的数据记录信息进行检验，比如记录信息是否合法，通过检验后，数据记录将被纳入一个区块中"><a href="#2-接收节点对收到的数据记录信息进行检验，比如记录信息是否合法，通过检验后，数据记录将被纳入一个区块中" class="headerlink" title="2.接收节点对收到的数据记录信息进行检验，比如记录信息是否合法，通过检验后，数据记录将被纳入一个区块中"></a>2.接收节点对收到的数据记录信息进行检验，比如记录信息是否合法，通过检验后，数据记录将被纳入一个区块中</h5><h5 id="3-全网所有的接收节点对区块执行共识算法（有工作量证明法、权益证明法等）"><a href="#3-全网所有的接收节点对区块执行共识算法（有工作量证明法、权益证明法等）" class="headerlink" title="3.全网所有的接收节点对区块执行共识算法（有工作量证明法、权益证明法等）"></a>3.全网所有的接收节点对区块执行共识算法（有工作量证明法、权益证明法等）</h5><h5 id="4-区块通过共识算法过程后被正式纳入区块链中存储，全网节点均表示接受该区块，而表示接受的方法，就是将该区块的随机散列值视为最新的区块散列值，新区块的制造者将以区块链为基础进行延长"><a href="#4-区块通过共识算法过程后被正式纳入区块链中存储，全网节点均表示接受该区块，而表示接受的方法，就是将该区块的随机散列值视为最新的区块散列值，新区块的制造者将以区块链为基础进行延长" class="headerlink" title="4.区块通过共识算法过程后被正式纳入区块链中存储，全网节点均表示接受该区块，而表示接受的方法，就是将该区块的随机散列值视为最新的区块散列值，新区块的制造者将以区块链为基础进行延长"></a>4.区块通过共识算法过程后被正式纳入区块链中存储，全网节点均表示接受该区块，而表示接受的方法，就是将该区块的随机散列值视为最新的区块散列值，新区块的制造者将以区块链为基础进行延长</h5><p> 比特币为例： ​ 1.节点分为：①发送节点②接收节点 发送节点在比特币体系里就是用于提交交易信息的用户。接收节点在比特币体系里面就是通常指矿工。 如果有新的交易要提交，那么发送节点就会在比特币网络进行交易信息的广播。矿工则要一直监听比特币网络里是否有交易广播。 ​ 2.矿工收到广播的交易信息后，需要校验这个信息的签名等内容是否合法。如果校验通过后，就需要将收到的所有交易信息按照一定的规则组装成一个数据块，也就是区块。 ​ 3.刚刚组装的区块还只是在自己这里，还未被纳入比特币网络中正式的区块链中。 如何才能被正式纳入呢？这里就涉及到共识算法了。 因为每个矿工都可能组装了自己的区块，在每10分钟之内，只可能有一个区块被纳入正式区块链，那么所有的矿工就要根据规则在最短的时间内使自己的区块被其它矿工认可，谁最先做到，那么谁的区块就会被正式纳入。 ​ 4.能纳入区块链的规则就是共识算法，比特币中使用的共识算法是工作量证明法。即让所有的矿工都去寻找一个随机数，这个随机数是通过Hash算法算出来的，并且算出来的随机数需要满足一定的条件才是大家认可的随机数（需要满足该随机数能使整个区块的哈希值小于目标值），谁先计算/猜到这个随机数，它的区块就能被全网接受。 ​ 5.然后这个区块就可以纳入正式区块链，放到链条的最后面，然后各个节点再开始挖下一个区块，就这么一直接连接下去。 ​ 6.挖到有效区块的节点可以获得奖励，这个奖励主要有2部分组成： ​ ①比特币体系约定每挖到一个有效区块奖励25比特币。 ​ ②交易手续费。（交易信息的提交节点需要以比特币形式付这一笔交易手续费）</p>
<hr>
<h4 id="十一、区块链应用"><a href="#十一、区块链应用" class="headerlink" title="十一、区块链应用"></a>十一、区块链应用</h4><h5 id="1-资产：数字资产发行、支付（跨境支付）、交易、结算"><a href="#1-资产：数字资产发行、支付（跨境支付）、交易、结算" class="headerlink" title="1.资产：数字资产发行、支付（跨境支付）、交易、结算"></a>1.资产：数字资产发行、支付（跨境支付）、交易、结算</h5><h5 id="2-记账：股权交易、供应链金融、商业积分"><a href="#2-记账：股权交易、供应链金融、商业积分" class="headerlink" title="2.记账：股权交易、供应链金融、商业积分"></a>2.记账：股权交易、供应链金融、商业积分</h5><h5 id="3-不可篡改：溯源、众筹、医疗证明、存在性证明"><a href="#3-不可篡改：溯源、众筹、医疗证明、存在性证明" class="headerlink" title="3.不可篡改：溯源、众筹、医疗证明、存在性证明"></a>3.不可篡改：溯源、众筹、医疗证明、存在性证明</h5><h5 id="4-点对点：共享经济、物联网"><a href="#4-点对点：共享经济、物联网" class="headerlink" title="4.点对点：共享经济、物联网"></a>4.点对点：共享经济、物联网</h5><h5 id="5-隐私：匿名交易"><a href="#5-隐私：匿名交易" class="headerlink" title="5.隐私：匿名交易"></a>5.隐私：匿名交易</h5><hr>
<h4 id="十二、区块链的安全问题"><a href="#十二、区块链的安全问题" class="headerlink" title="十二、区块链的安全问题"></a>十二、区块链的安全问题</h4><h5 id="1-区块链安全是因为其不可更改特性和分布式特性。"><a href="#1-区块链安全是因为其不可更改特性和分布式特性。" class="headerlink" title="1.区块链安全是因为其不可更改特性和分布式特性。"></a>1.区块链安全是因为其不可更改特性和分布式特性。</h5><p> 即如果要修改区块链中的数据，必须完成下面两件事情： ​ ①你需要计算出修改区块之后的所有区块的哈希值，这需要非常庞大的计算能力。 ​ ②你需要让超过50%的区块链用户同意你的修改。同时完成上面两件事情在短时间（甚至较长时间）内基本上是不可能的，所以区块链很安全。</p>
<h5 id="2-51-攻击"><a href="#2-51-攻击" class="headerlink" title="2.51%攻击"></a>2.51%攻击</h5><p> 举个例子： ​ 假设我具备了全网51%的算力，那么我可以偷偷的计算出一个这样的区块链，包含所有的比特币交易到我的私人账户的信息。这个区块链的长度为10，但是我不向全网进行广播。同时，我将所有的比特币放入到交易市场进行售卖。这笔交易记录在正常的区块链中。 ​ 当我交易所得美元进行提取时，正常的区块链长度应该是9。而我的隐藏的区块链长度是10，同时，将这个区块链广播到网络中去，然后通过观察网络会认为我后发的区块是正确的，从而到达修改了那笔交易记录的目的。</p>
<h5 id="3-双花问题"><a href="#3-双花问题" class="headerlink" title="3.双花问题"></a>3.双花问题</h5><p> 何为双花问题？从表意上来说，就是一个人在同一时间进行了两笔交易。这个问题，一直是支付系统的难点。无论是中心化的支付系统，还是去中心化的交易系统，都得面对这个问题。 ​ 举个例子： ​ 某人手里有20块钱。他同时与两个人进行了一笔20块钱的交易。现实生活中，你可以明确地发现问题。但是，相对于支付系统而言，并发的情况经常发生。一旦一个不完善的支付系统，双花问题是很容易发生的。当然，后端处理过程中，可以通过队列的形式来解决问题。但是，对于去中心化的交易系统而言，这个问题也需要解决。 每一笔交易的产生，都会产生一个区块，那么，往往会发现这么一种情况，如图： <img src="https://raw.githubusercontent.com/xx-C1/MDphoto/master/1551015183439.png" alt="1551015183439"> 我们可以看到，Block A和Block B就会同时去连接上一个区块。那么，相对于这个问题，比特币系统采用的规则就是选最长的那条链。通常，比特币采用的是6次确认规则。在1小时内，根据10分钟产生一个区块的原则，往往会生成一条6个长的区块。那么，只要确认下这条区块，就可以避免去连接其他区块了。 ​ 理论上是，区块链越长，准确性越高。</p>

        
      
    </div>
    <div>
    
    </div>

    
    
    
      <footer class="post-footer">
          <div class="post-eof"></div>
        
      </footer>
  </article>
  
  
  

    
  </div>

  
  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/"><i class="fa fa-angle-left" aria-label="上一页"></i></a><a class="page-number" href="/">1</a><span class="page-number current">2</span><a class="page-number" href="/page/3/">3</a><span class="space">&hellip;</span><a class="page-number" href="/page/5/">5</a><a class="extend next" rel="next" href="/page/3/"><i class="fa fa-angle-right" aria-label="下一页"></i></a>
  </nav>



          </div>
          

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image"
      src="/images/dxx.jpg"
      alt="xx_C1">
  <p class="site-author-name" itemprop="name">xx_C1</p>
  <div class="site-description" itemprop="description">Cyberspace Security</div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
        
          <a href="/archives/">
        
          <span class="site-state-item-count">23</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
    
      
      
      <div class="site-state-item site-state-categories">
        
          
            <a href="/categories/">
          
        
        <span class="site-state-item-count">7</span>
        <span class="site-state-item-name">分类</span>
        </a>
      </div>
    
      
      
      <div class="site-state-item site-state-tags">
        
          
            <a href="/tags/">
          
        
        <span class="site-state-item-count">9</span>
        <span class="site-state-item-name">标签</span>
        </a>
      </div>
    
  </nav>
</div>
  <div class="links-of-author motion-element">
      <span class="links-of-author-item">
      
      
        
      
      
        
      
        <a href="https://github.com/xx-C1" title="GitHub &rarr; https://github.com/xx-C1"><i class="fa fa-fw fa-github"></i>GitHub</a>
      </span>
    
      <span class="links-of-author-item">
      
      
        
      
      
        
      
        <a href="mailto:iduxinxing@gmail.com" title="E-Mail &rarr; mailto:iduxinxing@gmail.com" rel="noopener" target="_blank"><i class="fa fa-fw fa-envelope"></i>E-Mail</a>
      </span>
    
  </div>


  <div class="links-of-blogroll motion-element">
    <div class="links-of-blogroll-title">
      <i class="fa fa-fw fa-link"></i>
      友情链接
    </div>
    <ul class="links-of-blogroll-list">
        <li class="links-of-blogroll-item">
          <a href="https://p0sec.net/" title="https://p0sec.net/" rel="noopener" target="_blank">p0</a>
        </li>
      
        <li class="links-of-blogroll-item">
          <a href="https://seaii-blog.com/" title="https://seaii-blog.com/" rel="noopener" target="_blank">seaii</a>
        </li>
      
        <li class="links-of-blogroll-item">
          <a href="http://syf.ac.cn/" title="http://syf.ac.cn/" rel="noopener" target="_blank">7N1ght</a>
        </li>
      
        <li class="links-of-blogroll-item">
          <a href="https://www.windylh.com/" title="https://www.windylh.com/" rel="noopener" target="_blank">windylh</a>
        </li>
      
        <li class="links-of-blogroll-item">
          <a href="http://zhengbao.wang" title="http://zhengbao.wang" rel="noopener" target="_blank">Boogle</a>
        </li>
      
        <li class="links-of-blogroll-item">
          <a href="https://v0w.top" title="https://v0w.top" rel="noopener" target="_blank">vOw</a>
        </li>
      
        <li class="links-of-blogroll-item">
          <a href="https://ttonys.github.io/" title="https://ttonys.github.io/" rel="noopener" target="_blank">tongs</a>
        </li>
      
        <li class="links-of-blogroll-item">
          <a href="https://daolgts.github.io" title="https://daolgts.github.io" rel="noopener" target="_blank">daolgts</a>
        </li>
      
        <li class="links-of-blogroll-item">
          <a href="http://j0k3r.top/" title="http://j0k3r.top/" rel="noopener" target="_blank">joker</a>
        </li>
      
        <li class="links-of-blogroll-item">
          <a href="https://wzt.ac.cn/" title="https://wzt.ac.cn/" rel="noopener" target="_blank">CataLpa</a>
        </li>
      
        <li class="links-of-blogroll-item">
          <a href="http://asa9ao.xyz/" title="http://asa9ao.xyz/" rel="noopener" target="_blank">Asa9ao</a>
        </li>
      
    </ul>
  </div>

      </div>
        <div class="back-to-top motion-element">
          <i class="fa fa-arrow-up"></i>
          <span>0%</span>
        </div>
      

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; <span itemprop="copyrightYear">2019</span>
  <span class="with-love" id="animate">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">xx_C1</span>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item-icon">
      <i class="fa fa-area-chart"></i>
    </span>
    <span title="站点总字数">84k</span>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item-icon">
      <i class="fa fa-coffee"></i>
    </span>
    <span title="站点阅读时长">2:20</span>
</div>

<!--
  <div class="powered-by">由 <a href="https://hexo.io" class="theme-link" rel="noopener" target="_blank">Hexo</a> 强力驱动 v3.9.0</div>
  <span class="post-meta-divider">|</span>
  <div class="theme-info">主题 – <a href="https://theme-next.org" class="theme-link" rel="noopener" target="_blank">NexT.Gemini</a> v7.4.1</div>
-->

        
<div class="busuanzi-count">
  <script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
    <span class="post-meta-item" id="busuanzi_container_site_uv" style="display: none;">
      <span class="post-meta-item-icon">
        <i class="fa fa-user"></i>
      </span>
      <span class="site-uv" title="总访客量">
        <span id="busuanzi_value_site_uv"></span>
      </span>
    </span>
  
    <span class="post-meta-divider">|</span>
  
    <span class="post-meta-item" id="busuanzi_container_site_pv" style="display: none;">
      <span class="post-meta-item-icon">
        <i class="fa fa-eye"></i>
      </span>
      <span class="site-pv" title="总访问量">
        <span id="busuanzi_value_site_pv"></span>
      </span>
    </span>
  
</div>












        
      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js?v=3.1.0"></script>
  <script src="/lib/velocity/velocity.min.js?v=1.2.1"></script>
  <script src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
<script src="/js/utils.js?v=7.4.1"></script><script src="/js/motion.js?v=7.4.1"></script>
<script src="/js/schemes/pisces.js?v=7.4.1"></script>

<script src="/js/next-boot.js?v=7.4.1"></script>



  








  <script src="/js/local-search.js?v=7.4.1"></script>














  

  

  


<script src="/live2dw/lib/L2Dwidget.min.js?094cbace49a39548bed64abff5988b05"></script><script>L2Dwidget.init({"model":{"jsonPath":"/live2dw/assets/shizuku.model.json"},"display":{"position":"right","width":80,"height":132},"mobile":{"show":true},"log":false,"pluginJsPath":"lib/","pluginModelPath":"assets/","pluginRootPath":"live2dw/","tagMode":false});</script></body>
</html>
